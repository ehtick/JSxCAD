import { fromPolygonsWithHolesToTriangles } from './fromPolygonsWithHolesToTriangles.js';
import { initCgal } from '@jsxcad/algorithm-cgal';
import test from 'ava';

Error.stackTraceLimit = Infinity;

test.beforeEach(async (t) => {
  await initCgal();
});

test('fromPolygonsWithHolesToTriangles', (t) => {
  const polygonsWithHoles = [
    {
      points: [
        [-9, -8.999999999999998, 0],
        [9, -8.999999999999998, 0],
        [9, 8.999999999999998, 0],
        [-9, 8.999999999999998, 0],
      ],
      holes: [
        {
          points: [
            [6.6292, 3.250000000000002, 0],
            [6.60998528040323, 3.0549096779838734, 0],
            [6.553079532511287, 2.8673165676349117, 0],
            [6.460669612302546, 2.6944297669803987, 0],
            [3.210669612302546, -2.9347702330196, 0],
            [0.8314696123025462, -7.0555702330196, 0],
            [0.7071067811865487, -7.207106781186545, 0],
            [0.5555702330196034, -7.331469612302544, 0],
            [0.3826834323650909, -7.423879532511285, 0],
            [0.19509032201612922, -7.4807852804032295, 0],
            [7.657137397853899e-16, -7.499999999999999, 0],
            [-0.19509032201612772, -7.4807852804032295, 0],
            [-0.38268343236508945, -7.423879532511286, 0],
            [-0.5555702330196022, -7.331469612302545, 0],
            [-0.7071067811865476, -7.207106781186547, 0],
            [-0.8314696123025453, -7.055570233019601, 0],
            [-6.460669612302545, 2.694429766980398, 0],
            [-6.553079532511286, 2.86731656763491, 0],
            [-6.60998528040323, 3.0549096779838716, 0],
            [-6.6292, 3.2499999999999996, 0],
            [-6.60998528040323, 3.445090322016128, 0],
            [-6.553079532511286, 3.6326834323650896, 0],
            [-6.460669612302545, 3.8055702330196017, 0],
            [-6.336306781186547, 3.957106781186547, 0],
            [-6.184770233019602, 4.081469612302544, 0],
            [-6.01188343236509, 4.173879532511285, 0],
            [-5.824290322016128, 4.230785280403229, 0],
            [-5.6292, 4.249999999999998, 0],
            [-3.25, 4.249999999999998, 0],
            [5.6292, 4.249999999999998, 0],
            [5.8242903220161235, 4.2307852804032295, 0],
            [6.011883432365086, 4.173879532511287, 0],
            [6.184770233019599, 4.081469612302546, 0],
            [6.336306781186544, 3.9571067811865497, 0],
            [6.460669612302543, 3.8055702330196044, 0],
            [6.553079532511285, 3.6326834323650923, 0],
            [6.6099852804032295, 3.4450903220161306, 0],
          ],
          holes: [],
        },
      ],
    },
  ];

  const triangles = fromPolygonsWithHolesToTriangles({
    type: 'polygonsWithHoles',
    polygonsWithHoles,
    plane: [0, 0, 0.9999999999999998, 0],
    exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
  });
  t.deepEqual(triangles, [
    {
      points: [
        [0.19444444444444442, -7.4799999999999995, 0],
        [0, -7.5, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['7/36', '-187/25', '0'],
        ['0', '-15/2', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.552631578947368, 2.8666666666666663, 0],
        [-6.609756097560975, 3.0555555555555554, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['-249/38', '43/15', '0'],
        ['-271/41', '55/18', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [9, 9, 0],
        [6.609756097560975, 3.444444444444444, 0],
        [6.629629629629629, 3.25, 0],
      ],
      exactPoints: [
        ['9', '9', '0'],
        ['271/41', '31/9', '0'],
        ['179/27', '13/4', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.461538461538461, 3.8064516129032255, 0],
        [-9, 9, 0],
        [-6.552631578947368, 3.6333333333333333, 0],
      ],
      exactPoints: [
        ['-84/13', '118/31', '0'],
        ['-9', '9', '0'],
        ['-249/38', '109/30', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [9, 9, 0],
        [6.629629629629629, 3.25, 0],
        [6.609756097560975, 3.0555555555555554, 0],
      ],
      exactPoints: [
        ['9', '9', '0'],
        ['179/27', '13/4', '0'],
        ['271/41', '55/18', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.609756097560975, 3.0555555555555554, 0],
        [-9, 9, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['-271/41', '55/18', '0'],
        ['-9', '9', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [9, 9, 0],
        [6.609756097560975, 3.0555555555555554, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['9', '9', '0'],
        ['271/41', '55/18', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.609756097560975, 3.0555555555555554, 0],
        [6.552631578947368, 2.8666666666666663, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['271/41', '55/18', '0'],
        ['249/38', '43/15', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.552631578947368, 2.8666666666666663, 0],
        [6.461538461538461, 2.694444444444444, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['249/38', '43/15', '0'],
        ['84/13', '97/36', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.461538461538461, 2.694444444444444, 0],
        [3.2105263157894735, -2.9354838709677415, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['84/13', '97/36', '0'],
        ['61/19', '-91/31', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [3.2105263157894735, -2.9354838709677415, 0],
        [0.8305084745762711, -7.055555555555555, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['61/19', '-91/31', '0'],
        ['49/59', '-127/18', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [0, -7.5, 0],
        [-9, -9, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['0', '-15/2', '0'],
        ['-9', '-9', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [0.8305084745762711, -7.055555555555555, 0],
        [0.7073170731707317, -7.206896551724138, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['49/59', '-127/18', '0'],
        ['29/41', '-209/29', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [0.7073170731707317, -7.206896551724138, 0],
        [0.5555555555555555, -7.330508474576271, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['29/41', '-209/29', '0'],
        ['5/9', '-865/118', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [0.5555555555555555, -7.330508474576271, 0],
        [0.38235294117647056, -7.4230769230769225, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['5/9', '-865/118', '0'],
        ['13/34', '-193/26', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [0.38235294117647056, -7.4230769230769225, 0],
        [0.19444444444444442, -7.4799999999999995, 0],
        [9, -9, 0],
      ],
      exactPoints: [
        ['13/34', '-193/26', '0'],
        ['7/36', '-187/25', '0'],
        ['9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [0, -7.5, 0],
        [-0.19444444444444442, -7.4799999999999995, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['0', '-15/2', '0'],
        ['-7/36', '-187/25', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-0.19444444444444442, -7.4799999999999995, 0],
        [-0.38235294117647056, -7.4230769230769225, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['-7/36', '-187/25', '0'],
        ['-13/34', '-193/26', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-0.38235294117647056, -7.4230769230769225, 0],
        [-0.5555555555555555, -7.330508474576271, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['-13/34', '-193/26', '0'],
        ['-5/9', '-865/118', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-0.5555555555555555, -7.330508474576271, 0],
        [-0.7073170731707317, -7.206896551724138, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['-5/9', '-865/118', '0'],
        ['-29/41', '-209/29', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-0.7073170731707317, -7.206896551724138, 0],
        [-0.8305084745762711, -7.055555555555555, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['-29/41', '-209/29', '0'],
        ['-49/59', '-127/18', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-0.8305084745762711, -7.055555555555555, 0],
        [-6.461538461538461, 2.694444444444444, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['-49/59', '-127/18', '0'],
        ['-84/13', '97/36', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.461538461538461, 2.694444444444444, 0],
        [-6.552631578947368, 2.8666666666666663, 0],
        [-9, -9, 0],
      ],
      exactPoints: [
        ['-84/13', '97/36', '0'],
        ['-249/38', '43/15', '0'],
        ['-9', '-9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.629629629629629, 3.25, 0],
        [-9, 9, 0],
        [-6.609756097560975, 3.0555555555555554, 0],
      ],
      exactPoints: [
        ['-179/27', '13/4', '0'],
        ['-9', '9', '0'],
        ['-271/41', '55/18', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.609756097560975, 3.444444444444444, 0],
        [-9, 9, 0],
        [-6.629629629629629, 3.25, 0],
      ],
      exactPoints: [
        ['-271/41', '31/9', '0'],
        ['-9', '9', '0'],
        ['-179/27', '13/4', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.552631578947368, 3.6333333333333333, 0],
        [-9, 9, 0],
        [-6.609756097560975, 3.444444444444444, 0],
      ],
      exactPoints: [
        ['-249/38', '109/30', '0'],
        ['-9', '9', '0'],
        ['-271/41', '31/9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-5.823529411764706, 4.23076923076923, 0],
        [-5.629629629629629, 4.25, 0],
        [-9, 9, 0],
      ],
      exactPoints: [
        ['-99/17', '55/13', '0'],
        ['-152/27', '17/4', '0'],
        ['-9', '9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.337209302325581, 3.9565217391304346, 0],
        [-9, 9, 0],
        [-6.461538461538461, 3.8064516129032255, 0],
      ],
      exactPoints: [
        ['-545/86', '91/23', '0'],
        ['-9', '9', '0'],
        ['-84/13', '118/31', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.185185185185185, 4.081081081081081, 0],
        [-9, 9, 0],
        [-6.337209302325581, 3.9565217391304346, 0],
      ],
      exactPoints: [
        ['-167/27', '151/37', '0'],
        ['-9', '9', '0'],
        ['-545/86', '91/23', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-6.012820512820513, 4.173913043478261, 0],
        [-9, 9, 0],
        [-6.185185185185185, 4.081081081081081, 0],
      ],
      exactPoints: [
        ['-469/78', '96/23', '0'],
        ['-9', '9', '0'],
        ['-167/27', '151/37', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-5.823529411764706, 4.23076923076923, 0],
        [-9, 9, 0],
        [-6.012820512820513, 4.173913043478261, 0],
      ],
      exactPoints: [
        ['-99/17', '55/13', '0'],
        ['-9', '9', '0'],
        ['-469/78', '96/23', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [-5.629629629629629, 4.25, 0],
        [5.629629629629629, 4.25, 0],
        [-9, 9, 0],
      ],
      exactPoints: [
        ['-152/27', '17/4', '0'],
        ['152/27', '17/4', '0'],
        ['-9', '9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [5.629629629629629, 4.25, 0],
        [9, 9, 0],
        [-9, 9, 0],
      ],
      exactPoints: [
        ['152/27', '17/4', '0'],
        ['9', '9', '0'],
        ['-9', '9', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [5.823529411764706, 4.23076923076923, 0],
        [9, 9, 0],
        [5.629629629629629, 4.25, 0],
      ],
      exactPoints: [
        ['99/17', '55/13', '0'],
        ['9', '9', '0'],
        ['152/27', '17/4', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.012820512820513, 4.173913043478261, 0],
        [9, 9, 0],
        [5.823529411764706, 4.23076923076923, 0],
      ],
      exactPoints: [
        ['469/78', '96/23', '0'],
        ['9', '9', '0'],
        ['99/17', '55/13', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.185185185185185, 4.081081081081081, 0],
        [9, 9, 0],
        [6.012820512820513, 4.173913043478261, 0],
      ],
      exactPoints: [
        ['167/27', '151/37', '0'],
        ['9', '9', '0'],
        ['469/78', '96/23', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.337209302325581, 3.9565217391304346, 0],
        [9, 9, 0],
        [6.185185185185185, 4.081081081081081, 0],
      ],
      exactPoints: [
        ['545/86', '91/23', '0'],
        ['9', '9', '0'],
        ['167/27', '151/37', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.461538461538461, 3.8064516129032255, 0],
        [9, 9, 0],
        [6.337209302325581, 3.9565217391304346, 0],
      ],
      exactPoints: [
        ['84/13', '118/31', '0'],
        ['9', '9', '0'],
        ['545/86', '91/23', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.552631578947368, 3.6333333333333333, 0],
        [9, 9, 0],
        [6.461538461538461, 3.8064516129032255, 0],
      ],
      exactPoints: [
        ['249/38', '109/30', '0'],
        ['9', '9', '0'],
        ['84/13', '118/31', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
    {
      points: [
        [6.609756097560975, 3.444444444444444, 0],
        [9, 9, 0],
        [6.552631578947368, 3.6333333333333333, 0],
      ],
      exactPoints: [
        ['271/41', '31/9', '0'],
        ['9', '9', '0'],
        ['249/38', '109/30', '0'],
      ],
      holes: [],
      plane: [0, 0, 0.9999999999999998, 0],
      exactPlane: ['0', '0', '24605612895193225/24605612895193228', '0'],
    },
  ]);
});
