import { fromPaths } from './fromPaths.js';
import { initCgal } from '@jsxcad/algorithm-cgal';
import { offset } from './offset.js';
import { serialized } from './serialized.js';
import test from 'ava';
import { test as testGraph } from './test.js';

Error.stackTraceLimit = Infinity;

test.beforeEach(async (t) => {
  await initCgal();
});

test('offset', (t) => {
  const square = [
    [
      [-0.5, 0.5, -0.5],
      [0.5, 0.5, -0.5],
      [0.5, -0.5, -0.5],
      [-0.5, -0.5, -0.5],
    ],
  ];
  const geometry = fromPaths({}, square);
  const offsetGeometries = offset(geometry, -0.2);
  for (const geometry of offsetGeometries) {
    testGraph(geometry);
  }
  t.deepEqual(offsetGeometries.map(serialized), [
    '20\n' +
      '-41/64 -41/64 1/2\n' +
      '-3152519739159347/4503599627370496 -1/2 1/2\n' +
      '-385724968084973/562949953421312 -2598230554252209/4503599627370496 1/2\n' +
      '-1/2 -3152519739159347/4503599627370496 1/2\n' +
      '-2598230554252209/4503599627370496 -385724968084973/562949953421312 1/2\n' +
      '-3152519739159347/4503599627370496 1/2 1/2\n' +
      '1/2 -3152519739159347/4503599627370496 1/2\n' +
      '-1/2 3152519739159347/4503599627370496 1/2\n' +
      '2598230554252209/4503599627370496 -385724968084973/562949953421312 1/2\n' +
      '41/64 -41/64 1/2\n' +
      '385724968084973/562949953421312 -2598230554252209/4503599627370496 1/2\n' +
      '3152519739159347/4503599627370496 -1/2 1/2\n' +
      '1/2 3152519739159347/4503599627370496 1/2\n' +
      '3152519739159347/4503599627370496 1/2 1/2\n' +
      '385724968084973/562949953421312 2598230554252209/4503599627370496 1/2\n' +
      '41/64 41/64 1/2\n' +
      '2598230554252209/4503599627370496 385724968084973/562949953421312 1/2\n' +
      '-2598230554252209/4503599627370496 385724968084973/562949953421312 1/2\n' +
      '-41/64 41/64 1/2\n' +
      '-385724968084973/562949953421312 2598230554252209/4503599627370496 1/2\n' +
      '\n' +
      '18\n' +
      '3 2 0 1\n' +
      '3 1 0 3\n' +
      '3 3 0 4\n' +
      '3 1 3 5\n' +
      '3 3 6 7\n' +
      '3 6 8 9\n' +
      '3 11 9 10\n' +
      '3 6 9 11\n' +
      '3 6 11 12\n' +
      '3 11 13 12\n' +
      '3 13 14 15\n' +
      '3 12 15 16\n' +
      '3 13 15 12\n' +
      '3 6 12 7\n' +
      '3 3 7 5\n' +
      '3 7 17 18\n' +
      '3 7 18 5\n' +
      '3 18 19 5\n',
  ]);
});
