import { fromPaths } from './fromPaths.js';
import { initCgal } from '@jsxcad/algorithm-cgal';
import { offset } from './offset.js';
import { serialized } from './serialized.js';
import test from 'ava';
import { test as testGraph } from './test.js';

Error.stackTraceLimit = Infinity;

test.beforeEach(async (t) => {
  await initCgal();
});

test('offset', (t) => {
  const square = [
    [
      [-0.5, 0.5, -0.5],
      [0.5, 0.5, -0.5],
      [0.5, -0.5, -0.5],
      [-0.5, -0.5, -0.5],
    ],
  ];
  const geometry = fromPaths({}, square);
  const offsetGeometries = offset(geometry, -0.2);
  for (const geometry of offsetGeometries) {
    testGraph(geometry);
  }
  t.deepEqual(offsetGeometries.map(serialized), [
    '36\n' +
      '-13/19 -15/26 1/2\n' +
      '-2/3 -11/18 1/2\n' +
      '-16/23 -7/13 1/2\n' +
      '-7/13 -16/23 1/2\n' +
      '-1/2 -7/10 1/2\n' +
      '-15/26 -13/19 1/2\n' +
      '-25/39 -25/39 1/2\n' +
      '-11/18 -2/3 1/2\n' +
      '-7/10 -1/2 1/2\n' +
      '-7/10 1/2 1/2\n' +
      '1/2 -7/10 1/2\n' +
      '7/13 -16/23 1/2\n' +
      '15/26 -13/19 1/2\n' +
      '11/18 -2/3 1/2\n' +
      '25/39 -25/39 1/2\n' +
      '13/19 -15/26 1/2\n' +
      '2/3 -11/18 1/2\n' +
      '16/23 -7/13 1/2\n' +
      '7/10 -1/2 1/2\n' +
      '7/10 1/2 1/2\n' +
      '1/2 7/10 1/2\n' +
      '16/23 7/13 1/2\n' +
      '13/19 15/26 1/2\n' +
      '2/3 11/18 1/2\n' +
      '15/26 13/19 1/2\n' +
      '7/13 16/23 1/2\n' +
      '11/18 2/3 1/2\n' +
      '25/39 25/39 1/2\n' +
      '-1/2 7/10 1/2\n' +
      '-7/13 16/23 1/2\n' +
      '-11/18 2/3 1/2\n' +
      '-25/39 25/39 1/2\n' +
      '-15/26 13/19 1/2\n' +
      '-2/3 11/18 1/2\n' +
      '-16/23 7/13 1/2\n' +
      '-13/19 15/26 1/2\n' +
      '\n' +
      '34\n' +
      '3 2 0 1\n' +
      '3 5 3 4\n' +
      '3 6 2 1\n' +
      '3 5 4 7\n' +
      '3 7 4 6\n' +
      '3 4 2 6\n' +
      '3 8 2 4\n' +
      '3 8 4 9\n' +
      '3 4 10 9\n' +
      '3 10 11 12\n' +
      '3 14 12 13\n' +
      '3 15 12 14\n' +
      '3 15 14 16\n' +
      '3 10 12 15\n' +
      '3 18 15 17\n' +
      '3 10 15 18\n' +
      '3 10 18 9\n' +
      '3 18 19 20\n' +
      '3 19 21 22\n' +
      '3 19 22 23\n' +
      '3 26 24 25\n' +
      '3 26 25 27\n' +
      '3 25 23 27\n' +
      '3 19 23 25\n' +
      '3 19 25 20\n' +
      '3 18 20 9\n' +
      '3 20 28 9\n' +
      '3 31 29 30\n' +
      '3 29 32 30\n' +
      '3 28 29 31\n' +
      '3 28 31 9\n' +
      '3 31 33 34\n' +
      '3 33 35 34\n' +
      '3 31 34 9\n',
  ]);
});
