import { initCgal } from './getCgal.js';
import { insetOfPolygonWithHoles } from './insetOfPolygonWithHoles.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('insetOfPolygonWithHoles/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const inset = insetOfPolygonWithHoles(0.1, 0.05, 0.5, 8, {
    plane: xyPlane,
    points: polygon,
    holes: [],
  });
  t.deepEqual(JSON.parse(JSON.stringify(inset)), [
    {
      points: [
        [0.3214285714285714, 0.11776061776061775, 0],
        [0.25, 0.08918918918918918, 0],
        [0.17857142857142855, 0.11776061776061775, 0],
        [-0.1894736842105263, 0.3298050663904322, 0],
        [-0.1894736842105263, -0.3298050663904322, 0],
        [0.17857142857142855, -0.11776061776061775, 0],
        [0.25, -0.08918918918918918, 0],
        [0.3214285714285714, -0.11776061776061775, 0],
        [0.6894736842105262, -0.3298050663904322, 0],
        [0.6894736842105262, 0.3298050663904322, 0],
      ],
      exactPoints: [
        ['9/28', '61/518', '0'],
        ['1/4', '33/370', '0'],
        ['5/28', '61/518', '0'],
        ['-18/95', '17511/53095', '0'],
        ['-18/95', '-17511/53095', '0'],
        ['5/28', '-61/518', '0'],
        ['1/4', '-33/370', '0'],
        ['9/28', '-61/518', '0'],
        ['131/190', '-17511/53095', '0'],
        ['131/190', '17511/53095', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.35526315789473684, 0.08392603129445234, 0],
        [0.25, 0.039189189189189184, 0],
        [0.14473684210526314, 0.08392603129445234, 0],
        [-0.1394736842105263, 0.2476702633313673, 0],
        [-0.1394736842105263, -0.2476702633313673, 0],
        [0.14473684210526314, -0.08392603129445234, 0],
        [0.25, -0.039189189189189184, 0],
        [0.35526315789473684, -0.08392603129445234, 0],
        [0.6394736842105263, -0.2476702633313673, 0],
        [0.6394736842105263, 0.2476702633313673, 0],
      ],
      exactPoints: [
        ['27/76', '59/703', '0'],
        ['1/4', '29/740', '0'],
        ['11/76', '59/703', '0'],
        ['-53/380', '35693/144115', '0'],
        ['-53/380', '-35693/144115', '0'],
        ['11/76', '-59/703', '0'],
        ['1/4', '-29/740', '0'],
        ['27/76', '-59/703', '0'],
        ['243/380', '-35693/144115', '0'],
        ['243/380', '35693/144115', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.0894736842105263, -0.1631282959789057, 0],
        [0.109375, -0.048564189189189186, 0],
        [0.22439544807965858, 0, 0],
        [0.109375, 0.048564189189189186, 0],
        [-0.0894736842105263, 0.1631282959789057, 0],
      ],
      exactPoints: [
        ['-17/190', '-79189/485440', '0'],
        ['7/64', '-115/2368', '0'],
        ['631/2812', '0', '0'],
        ['7/64', '115/2368', '0'],
        ['-17/190', '79189/485440', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.390625, 0.048564189189189186, 0],
        [0.2756045519203414, 0, 0],
        [0.390625, -0.048564189189189186, 0],
        [0.5894736842105263, -0.1631282959789057, 0],
        [0.5894736842105263, 0.1631282959789057, 0],
      ],
      exactPoints: [
        ['25/64', '115/2368', '0'],
        ['775/2812', '0', '0'],
        ['25/64', '-115/2368', '0'],
        ['56/95', '-79189/485440', '0'],
        ['56/95', '79189/485440', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.039473684210526314, -0.07782387839776649, 0],
        [0.07352941176470587, -0.01271860095389507, 0],
        [0.10405405405405405, 0, 0],
        [0.07352941176470587, 0.01271860095389507, 0],
        [-0.039473684210526314, 0.07782387839776649, 0],
      ],
      exactPoints: [
        ['-3/76', '-2007/25789', '0'],
        ['5/68', '-8/629', '0'],
        ['77/740', '0', '0'],
        ['5/68', '8/629', '0'],
        ['-3/76', '2007/25789', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.4264705882352941, 0.01271860095389507, 0],
        [0.3959459459459459, 0, 0],
        [0.4264705882352941, -0.01271860095389507, 0],
        [0.5394736842105262, -0.07782387839776649, 0],
        [0.5394736842105262, 0.07782387839776649, 0],
      ],
      exactPoints: [
        ['29/68', '8/629', '0'],
        ['293/740', '0', '0'],
        ['29/68', '-8/629', '0'],
        ['41/76', '-2007/25789', '0'],
        ['41/76', '2007/25789', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
  ]);
});
