import { initCgal } from './getCgal.js';
import { insetOfPolygonWithHoles } from './insetOfPolygonWithHoles.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('insetOfPolygonWithHoles/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const inset = insetOfPolygonWithHoles(0.1, 0.05, 0.5, {
    plane: xyPlane,
    points: polygon,
    holes: [],
  });
  t.deepEqual(JSON.parse(JSON.stringify(inset)), [
    {
      points: [
        [0.30555702330196033, 0.10604222795893474, 0],
        [0.2882683432365091, 0.09680123593806055, 0],
        [0.2695090322016129, 0.09111066114886616, 0],
        [0.25000000000000006, 0.08918918918918918, 0],
        [0.2304909677983872, 0.09111066114886612, 0],
        [0.21173165676349104, 0.09680123593806049, 0],
        [0.19444297669803978, 0.10604222795893464, 0],
        [-0.1894736842105263, 0.32723086450085076, 0],
        [-0.1894736842105263, -0.32723086450085076, 0],
        [0.19444297669803978, -0.10604222795893466, 0],
        [0.211731656763491, -0.0968012359380605, 0],
        [0.23049096779838715, -0.09111066114886614, 0],
        [0.25, -0.08918918918918918, 0],
        [0.26950903220161243, -0.09111066114886605, 0],
        [0.28826834323650863, -0.09680123593806036, 0],
        [0.3055570233019599, -0.10604222795893446, 0],
        [0.6894736842105262, -0.3272308645008507, 0],
        [0.6894736842105262, 0.32723086450085076, 0],
      ],
      exactPoints: [
        [
          '2752212992566293/9007199254740992',
          '7641147813142331/72057594037927936',
          '0',
        ],
        [
          '2596490406365305/9007199254740992',
          '6975264161594447/72057594037927936',
          '0',
        ],
        [
          '4855043107984667/18014398509481984',
          '6565215033592211/72057594037927936',
          '0',
        ],
        [
          '4503599627370497/18014398509481984',
          '6426758387166545/72057594037927936',
          '0',
        ],
        [
          '8304312293512653/36028797018963968',
          '410325939599513/4503599627370496',
          '0',
        ],
        [
          '238388652625649/1125899906842624',
          '6975264161594443/72057594037927936',
          '0',
        ],
        [
          '437846658701051/2251799813685248',
          '1910286953285581/18014398509481984',
          '0',
        ],
        [
          '-3413254454428165/18014398509481984',
          '5894867197720627/18014398509481984',
          '0',
        ],
        [
          '-3413254454428165/18014398509481984',
          '-5894867197720627/18014398509481984',
          '0',
        ],
        [
          '437846658701051/2251799813685248',
          '-7641147813142325/72057594037927936',
          '0',
        ],
        [
          '7628436884020767/36028797018963968',
          '-1743816040398611/18014398509481984',
          '0',
        ],
        [
          '8304312293512651/36028797018963968',
          '-6565215033592209/72057594037927936',
          '0',
        ],
        ['1/4', '-6426758387166545/72057594037927936', '0'],
        [
          '4855043107984659/18014398509481984',
          '-6565215033592203/72057594037927936',
          '0',
        ],
        [
          '2596490406365301/9007199254740992',
          '-3487632080797217/36028797018963968',
          '0',
        ],
        [
          '2752212992566289/9007199254740992',
          '-7641147813142311/72057594037927936',
          '0',
        ],
        [
          '3105113427292289/4503599627370496',
          '-2947433598860313/9007199254740992',
          '0',
        ],
        [
          '3105113427292289/4503599627370496',
          '5894867197720627/18014398509481984',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.3333355349529405, 0.0644687473438075, 0],
        [0.3074025148547636, 0.050607259312496225, 0],
        [0.27926354830241934, 0.04207139712870463, 0],
        [0.2500000000000001, 0.039189189189189164, 0],
        [0.22073645169758083, 0.04207139712870457, 0],
        [0.19259748514523656, 0.05060725931249614, 0],
        [0.16666446504705965, 0.06446874734380736, 0],
        [-0.13947368421052628, 0.2408462967512761, 0],
        [-0.13947368421052628, -0.24084629675127614, 0],
        [0.16666446504705965, -0.06446874734380738, 0],
        [0.1925974851452365, -0.05060725931249614, 0],
        [0.22073645169758074, -0.0420713971287046, 0],
        [0.25, -0.039189189189189164, 0],
        [0.2792635483024186, -0.04207139712870449, 0],
        [0.30740251485476294, -0.05060725931249595, 0],
        [0.3333355349529399, -0.06446874734380709, 0],
        [0.6394736842105262, -0.24084629675127608, 0],
        [0.6394736842105262, 0.24084629675127617, 0],
      ],
      exactPoints: [
        [
          '6004839164013631/18014398509481984',
          '2322731412116913/36028797018963968',
          '0',
        ],
        [
          '5537671405410667/18014398509481984',
          '3646637346912001/72057594037927936',
          '0',
        ],
        [
          '5030764848291753/18014398509481984',
          '3031563654908645/72057594037927936',
          '0',
        ],
        [
          '2251799813685249/9007199254740992',
          '2823878685270147/72057594037927936',
          '0',
        ],
        [
          '1988217203224621/9007199254740992',
          '3031563654908641/72057594037927936',
          '0',
        ],
        [
          '433690981166291/2251799813685248',
          '3646637346911995/72057594037927936',
          '0',
        ],
        [
          '6004720181454727/36028797018963968',
          '580682853029227/9007199254740992',
          '0',
        ],
        [
          '-5025069057908131/36028797018963968',
          '1084675292302611/4503599627370496',
          '0',
        ],
        [
          '-5025069057908131/36028797018963968',
          '-8677402338420889/36028797018963968',
          '0',
        ],
        [
          '6004720181454727/36028797018963968',
          '-4645462824233817/72057594037927936',
          '0',
        ],
        [
          '3469527849330327/18014398509481984',
          '-3646637346911995/72057594037927936',
          '0',
        ],
        [
          '7952868812898481/36028797018963968',
          '-3031563654908643/72057594037927936',
          '0',
        ],
        ['1/4', '-2823878685270147/72057594037927936', '0'],
        [
          '1257691212072935/4503599627370496',
          '-3031563654908635/72057594037927936',
          '0',
        ],
        [
          '5537671405410655/18014398509481984',
          '-3646637346911981/72057594037927936',
          '0',
        ],
        [
          '1501209791003405/4503599627370496',
          '-1161365706058449/18014398509481984',
          '0',
        ],
        [
          '719983361480941/1125899906842624',
          '-8677402338420887/36028797018963968',
          '0',
        ],
        [
          '719983361480941/1125899906842624',
          '4338701169210445/18014398509481984',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.0894736842105263, -0.15446172900170155, 0],
        [0.13888595339607956, -0.022895266728680128, 0],
        [0.17346331352698202, -0.004413282686931824, 0],
        [0.1880119567969525, -1.3127954928201703e-18, 0],
        [0.1734633135269821, 0.004413282686931796, 0],
        [0.13888595339607956, 0.0228952667286801, 0],
        [-0.0894736842105263, 0.15446172900170152, 0],
      ],
      exactPoints: [
        [
          '-6447258413919867/72057594037927936',
          '-5565070281400525/36028797018963968',
          '0',
        ],
        [
          '156371681990395/1125899906842624',
          '-1649777835325311/72057594037927936',
          '0',
        ],
        [
          '3124837256650271/18014398509481984',
          '-5088168515672787/1152921504606846976',
          '0',
        ],
        [
          '6773844628575625/36028797018963968',
          '-6816423913268851/5192296858534827628530496329220096',
          '0',
        ],
        [
          '6249674513300545/36028797018963968',
          '5088168515672755/1152921504606846976',
          '0',
        ],
        [
          '156371681990395/1125899906842624',
          '1649777835325309/72057594037927936',
          '0',
        ],
        [
          '-6447258413919867/72057594037927936',
          '1391267570350131/9007199254740992',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.36111404660392066, 0.022895266728680294, 0],
        [0.32653668647301815, 0.004413282686931907, 0],
        [0.31198804320304746, 1.0027896883913869e-17, 0],
        [0.32653668647301726, -0.0044132826869315465, 0],
        [0.3611140466039198, -0.02289526672867974, 0],
        [0.5894736842105263, -0.1544617290017015, 0],
        [0.5894736842105263, 0.15446172900170158, 0],
      ],
      exactPoints: [
        [
          '1626313085723669/4503599627370496',
          '1649777835325323/72057594037927936',
          '0',
        ],
        [
          '1470590499522681/4503599627370496',
          '5088168515672883/1152921504606846976',
          '0',
        ],
        [
          '5620276940453179/18014398509481984',
          '3254238593003573/324518553658426726783156020576256',
          '0',
        ],
        [
          '1470590499522677/4503599627370496',
          '-5088168515672467/1152921504606846976',
          '0',
        ],
        [
          '6505252342894661/18014398509481984',
          '-1649777835325283/72057594037927936',
          '0',
        ],
        [
          '5309506929110479/9007199254740992',
          '-5565070281400523/36028797018963968',
          '0',
        ],
        [
          '5309506929110479/9007199254740992',
          '2782535140700263/18014398509481984',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.039473684210526314, -0.06807716125212698, 0],
        [0.07868770437011055, -1.3877787807814457e-17, 0],
        [-0.039473684210526314, 0.06807716125212696, 0],
      ],
      exactPoints: [
        [
          '-2844378712023471/72057594037927936',
          '-1226369112190081/18014398509481984',
          '0',
        ],
        ['2835023328638957/36028797018963968', '-1/72057594037927936', '0'],
        [
          '-2844378712023471/72057594037927936',
          '2452738224380161/36028797018963968',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.4213122956298895, 5.1110877048292264e-17, 0],
        [0.5394736842105262, -0.0680771612521269, 0],
        [0.5394736842105262, 0.068077161252127, 0],
      ],
      exactPoints: [
        [
          '3794843795210757/9007199254740992',
          '4146606973981371/81129638414606681695789005144064',
          '0',
        ],
        [
          '4859146966373429/9007199254740992',
          '-2452738224380159/36028797018963968',
          '0',
        ],
        [
          '4859146966373429/9007199254740992',
          '4905476448760325/72057594037927936',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
  ]);
});
