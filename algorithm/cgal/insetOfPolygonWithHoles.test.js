import { initCgal } from './getCgal.js';
import { insetOfPolygonWithHoles } from './insetOfPolygonWithHoles.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('insetOfPolygonWithHoles/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const inset = insetOfPolygonWithHoles(0.1, 0.05, 0.5, {
    plane: xyPlane,
    points: polygon,
    holes: [],
  });
  t.deepEqual(JSON.parse(JSON.stringify(inset)), [
    {
      points: [
        [0.28846153846153844, 0.0961659333752357, 0],
        [0.25, 0.08918918918918918, 0],
        [0.21153846153846154, 0.0961659333752357, 0],
        [-0.1894736842105263, 0.3272039131937033, 0],
        [-0.1894736842105263, -0.3272039131937033, 0],
        [0.21153846153846154, -0.0961659333752357, 0],
        [0.25, -0.08918918918918918, 0],
        [0.28846153846153844, -0.0961659333752357, 0],
        [0.6894736842105262, -0.3272039131937033, 0],
        [0.6894736842105262, 0.3272039131937033, 0],
      ],
      exactPoints: [
        ['15/52', '153/1591', '0'],
        ['1/4', '33/370', '0'],
        ['11/52', '153/1591', '0'],
        ['-18/95', '2774699/8480030', '0'],
        ['-18/95', '-2774699/8480030', '0'],
        ['11/52', '-153/1591', '0'],
        ['1/4', '-33/370', '0'],
        ['15/52', '-153/1591', '0'],
        ['131/190', '-2774699/8480030', '0'],
        ['131/190', '2774699/8480030', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.3071428571428571, 0.05125815470643057, 0],
        [0.25, 0.039189189189189184, 0],
        [0.19285714285714284, 0.05125815470643057, 0],
        [-0.1394736842105263, 0.24272627788187082, 0],
        [-0.1394736842105263, -0.24272627788187082, 0],
        [0.19285714285714284, -0.05125815470643057, 0],
        [0.25, -0.039189189189189184, 0],
        [0.3071428571428571, -0.05125815470643057, 0],
        [0.6394736842105263, -0.24272627788187082, 0],
        [0.6394736842105263, 0.24272627788187082, 0],
      ],
      exactPoints: [
        ['43/140', '55/1073', '0'],
        ['1/4', '29/740', '0'],
        ['27/140', '55/1073', '0'],
        ['-53/380', '373739/1539755', '0'],
        ['-53/380', '-373739/1539755', '0'],
        ['27/140', '-55/1073', '0'],
        ['1/4', '-29/740', '0'],
        ['43/140', '-55/1073', '0'],
        ['243/380', '-373739/1539755', '0'],
        ['243/380', '373739/1539755', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.0894736842105263, -0.15526915283012843, 0],
        [0.17307692307692307, -0.004004004004004004, 0],
        [0.19386694386694386, 0, 0],
        [0.17307692307692307, 0.004004004004004004, 0],
        [-0.0894736842105263, 0.15526915283012843, 0],
      ],
      exactPoints: [
        ['-17/190', '-826757/5324670', '0'],
        ['9/52', '-4/999', '0'],
        ['373/1924', '0', '0'],
        ['9/52', '4/999', '0'],
        ['-17/190', '826757/5324670', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.32692307692307687, 0.004004004004004004, 0],
        [0.3061330561330561, 0, 0],
        [0.32692307692307687, -0.004004004004004004, 0],
        [0.5894736842105263, -0.15526915283012843, 0],
        [0.5894736842105263, 0.15526915283012843, 0],
      ],
      exactPoints: [
        ['17/52', '4/999', '0'],
        ['589/1924', '0', '0'],
        ['17/52', '-4/999', '0'],
        ['56/95', '-826757/5324670', '0'],
        ['56/95', '826757/5324670', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.039473684210526314, -0.07032628983848495, 0],
        [0.0825915122253795, 0, 0],
        [-0.039473684210526314, 0.07032628983848495, 0],
      ],
      exactPoints: [
        ['-3/76', '-29125/414141', '0'],
        ['39413/477204', '0', '0'],
        ['-3/76', '29125/414141', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.4174084877746205, 0, 0],
        [0.5394736842105262, -0.07032628983848495, 0],
        [0.5394736842105262, 0.07032628983848495, 0],
      ],
      exactPoints: [
        ['199189/477204', '0', '0'],
        ['41/76', '-29125/414141', '0'],
        ['41/76', '29125/414141', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
  ]);
});
