import {
  BOOLEAN_ADD,
  booleansOfPolygonsWithHoles,
} from './booleansOfPolygonsWithHoles.js';

import { initCgal } from './getCgal.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('booleansOfPolygonsWithHoles/self', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const union = booleansOfPolygonsWithHoles(
    [BOOLEAN_ADD, BOOLEAN_ADD],
    [
      {
        plane: xyPlane,
        points: polygon,
        holes: [],
      },
      {
        plane: xyPlane,
        points: polygon,
        holes: [],
      },
    ]
  );
  t.deepEqual(JSON.parse(JSON.stringify(union)), [
    {
      points: [
        [-0.28947368421052627, -0.5, 0],
        [0.25, -0.18918918918918917, 0],
        [0.7894736842105262, -0.5, 0],
        [0.7894736842105262, 0.5, 0],
        [0.25, 0.18918918918918917, 0],
        [-0.28947368421052627, 0.5, 0],
      ],
      exactPoints: [
        [
          '-5214694305376363/18014398509481984',
          '-1/2',
          '-5214694305376363/18014398509481984',
        ],
        ['1/4', '-6816258895479669/36028797018963968', '1/4'],
        [
          '7110946780058677/9007199254740992',
          '-1/2',
          '7110946780058677/9007199254740992',
        ],
        [
          '7110946780058677/9007199254740992',
          '1/2',
          '7110946780058677/9007199254740992',
        ],
        ['1/4', '6816258895479669/36028797018963968', '1/4'],
        [
          '-5214694305376363/18014398509481984',
          '1/2',
          '-5214694305376363/18014398509481984',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
  ]);
});
