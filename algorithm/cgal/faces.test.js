import { faces } from './faces.js';
import { initCgal } from './getCgal.js';

import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('Faces', (t) => {
  const results = faces([
    {
      type: 'graph',
      matrix: [
        1,
        0,
        0,
        0,
        0,
        7.076142131979695,
        7.065989847715736,
        0,
        0,
        -0.7065989847715736,
        0.7076142131979695,
        0,
        5,
        -3.5380710659898473,
        -3.532994923857868,
        1,
        '1',
        '0',
        '0',
        '5',
        '0',
        '1394/197',
        '-696/985',
        '-697/197',
        '0',
        '1392/197',
        '697/985',
        '-696/197',
        '1',
      ],
      tags: [],
      graph: {
        isClosed: true,
        isEmpty: false,
        isLazy: true,
        provenance: 'algorithm/cgal/fromSurfaceMeshToLazyGraph',
        serializedSurfaceMesh:
          '8\n' +
          '-10 1 -5\n' +
          '0 1 -5\n' +
          '0 0 -5\n' +
          '-10 0 -5\n' +
          '-10 1 5\n' +
          '0 1 5\n' +
          '0 0 5\n' +
          '-10 0 5\n' +
          '\n' +
          '12\n' +
          '3 2 3 0\n' +
          '3 0 1 2\n' +
          '3 7 6 4\n' +
          '3 5 4 6\n' +
          '3 4 3 7\n' +
          '3 3 4 0\n' +
          '3 5 0 4\n' +
          '3 0 5 1\n' +
          '3 6 1 5\n' +
          '3 1 6 2\n' +
          '3 7 2 6\n' +
          '3 2 7 3\n' +
          '',
        hash: 'UrrFjxNGlYnRuSBlWQN3MkTQysJls2S9awXoove14Lc=',
      },
      cache: {
        boundingBox: [
          [-5.000000000000026, -7.071065989847738, -7.071065989847738],
          [5.0000000000000195, 7.071065989847745, 7.071065989847744],
        ],
      },
    },
  ]);
  t.deepEqual(JSON.parse(JSON.stringify(results)), [
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [-5.000000000000001, 9.99378287900526],
            [-5.000000000000001, -0.006217120994737939],
            [5.000000000000001, -0.006217120994737939],
            [5.000000000000001, 9.99378287900526],
          ],
          exactPoints: [
            [
              '-232202547395424126636300831222658159179749864028407044849532928197/46440509479084815486387325036943093524542562636679444122700873728',
              '403812417575751686333715266787971/40406362882274812172707414671360',
            ],
            [
              '-232202547395424126636300831222658159179749864028407044849532928197/46440509479084815486387325036943093524542562636679444122700873728',
              '-251211246996390533284466664829/40406362882274812172707414671360',
            ],
            [
              '232202547395424126636300831222658159179749864028407044849532928197/46440509479084815486387325036943093524542562636679444122700873728',
              '-251211246996390533284466664829/40406362882274812172707414671360',
            ],
            [
              '232202547395424126636300831222658159179749864028407044849532928197/46440509479084815486387325036943093524542562636679444122700873728',
              '403812417575751686333715266787971/40406362882274812172707414671360',
            ],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, -1.7319479184152438e-15],
      exactPlane: [
        '0',
        '0',
        '1',
        '-77247458451407724087155770785791/44601490397061252621324437686443730495476858880',
      ],
      matrix: [
        0.9999999999999998,
        0,
        0,
        0,
        0,
        -0.7065989847715736,
        0.7076142131979695,
        0,
        0,
        -0.7076142131979695,
        -0.7065989847715736,
        0,
        0,
        -0.010145001420153316,
        -7.065989847715734,
        1,
        '232202547395424077431936625184715467622712813183397220613504368640/232202547395424126636300831222658159179749864028407044849532928197',
        '0',
        '0',
        '0',
        '0',
        '-8822848177588476634417054309416960/12486358412248059992896519456948027',
        '-8835524683590758928432021341470720/12486358412248059992896519456948027',
        '-621298761230988213307809094016880890848903745687025/61241860449300837265593831310324664083765029637056419',
        '0',
        '8835524683590758928432021341470720/12486358412248059992896519456948027',
        '-8822848177588476634417054309416960/12486358412248059992896519456948027',
        '-620852746327092548260354396710530384326494781440000/87864936082210670395400044921556189503249683840827',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [-0.006060606060606061, -7.071428571428571],
            [7.071428571428571, -0.006060606060606061],
            [0.006060606060606061, 7.071428571428571],
            [-7.071428571428571, 0.006060606060606061],
          ],
          exactPoints: [
            ['-1/165', '-99/14'],
            ['99/14', '-1/165'],
            ['1/165', '99/14'],
            ['-99/14', '1/165'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        0,
        0,
        -1,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        0,
        5,
        0,
        0,
        1,
        '0',
        '0',
        '1',
        '5',
        '0',
        '1',
        '0',
        '0',
        '-1',
        '0',
        '0',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [5, -0.006217120994737939],
            [5, 9.99378287900526],
            [-5, 9.99378287900526],
            [-5, -0.006217120994737939],
          ],
          exactPoints: [
            [
              '1350631426199681393181260241809272387418694186537663546394379550917/270126285239936268795379207154265939172331427138530744431670198272',
              '-251211246996390533284466664829/40406362882274812172707414671360',
            ],
            [
              '1350631426199681393181260241809272387418694186537663546394379550917/270126285239936268795379207154265939172331427138530744431670198272',
              '403812417575751686333715266787971/40406362882274812172707414671360',
            ],
            [
              '-1350631426199681393181260241809272387418694186537663546394379550917/270126285239936268795379207154265939172331427138530744431670198272',
              '403812417575751686333715266787971/40406362882274812172707414671360',
            ],
            [
              '-1350631426199681393181260241809272387418694186537663546394379550917/270126285239936268795379207154265939172331427138530744431670198272',
              '-251211246996390533284466664829/40406362882274812172707414671360',
            ],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, -1.7319479184152438e-15],
      exactPlane: [
        '0',
        '0',
        '1',
        '-77247458451407724087155770785791/44601490397061252621324437686443730495476858880',
      ],
      matrix: [
        0.9999999999999999,
        0,
        0,
        0,
        0,
        0.7065989847715736,
        -0.7076142131979695,
        0,
        0,
        0.7076142131979695,
        0.7065989847715736,
        0,
        0,
        0.010145001420153316,
        7.065989847715734,
        1,
        '1350631426199681343976896035771329695861657135692653722158350991360/1350631426199681393181260241809272387418694186537663546394379550917',
        '0',
        '0',
        '0',
        '0',
        '8822848177588476634417054309416960/12486358412248059992896519456948027',
        '8835524683590758928432021341470720/12486358412248059992896519456948027',
        '621298761230988213307809094016880890848903745687025/61241860449300837265593831310324664083765029637056419',
        '0',
        '-8835524683590758928432021341470720/12486358412248059992896519456948027',
        '8822848177588476634417054309416960/12486358412248059992896519456948027',
        '620852746327092548260354396710530384326494781440000/87864936082210670395400044921556189503249683840827',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [7.071428571428571, 0.006060606060606061],
            [-0.006060606060606061, 7.071428571428571],
            [-7.071428571428571, -0.006060606060606061],
            [0.006060606060606061, -7.071428571428571],
          ],
          exactPoints: [
            ['99/14', '1/165'],
            ['-1/165', '99/14'],
            ['-99/14', '-1/165'],
            ['1/165', '-99/14'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        -1,
        0,
        0,
        0,
        -5,
        0,
        0,
        1,
        '0',
        '0',
        '-1',
        '-5',
        '0',
        '1',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [5, 9.993782879005261],
            [-5, 9.993782879005261],
            [-5, -0.006217120994740779],
            [5, -0.006217120994740779],
          ],
          exactPoints: [
            [
              '337858723805452748255480489941157578605876031989089803242104160453/67571744761090543324820700069066587353247248401844343154531106816',
              '486950268253112351537735044586059/48725319946272567620029529456640',
            ],
            [
              '-337858723805452748255480489941157578605876031989089803242104160453/67571744761090543324820700069066587353247248401844343154531106816',
              '486950268253112351537735044586059/48725319946272567620029529456640',
            ],
            [
              '-337858723805452748255480489941157578605876031989089803242104160453/67571744761090543324820700069066587353247248401844343154531106816',
              '-302931209613432854504423138741/48725319946272567620029529456640',
            ],
            [
              '337858723805452748255480489941157578605876031989089803242104160453/67571744761090543324820700069066587353247248401844343154531106816',
              '-302931209613432854504423138741/48725319946272567620029529456640',
            ],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 6.217248937900881e-16],
      exactPlane: [
        '0',
        '0',
        '1',
        '13864928439996268649019399471103/22300745198530619972409217702074857764222402560',
      ],
      matrix: [
        0.9999999999999999,
        0,
        0,
        0,
        0,
        0.7076142131979695,
        0.7065989847715735,
        0,
        0,
        -0.7065989847715735,
        0.7076142131979695,
        0,
        0,
        -7.065989847715736,
        0.010145001420154981,
        1,
        '337858723805452716624103500345332936766236242009221715772655534080/337858723805452748255480489941157578605876031989089803242104160453',
        '0',
        '0',
        '0',
        '0',
        '259868373046787027306824157102080/367245835654354723613317470262923',
        '-1470474696264746105736175718236160/2081059735374676767142132331489897',
        '-103475457721182091376725732785088397387749130240000/14644156013701774952478154105950782769986574570903',
        '0',
        '1470474696264746105736175718236160/2081059735374676767142132331489897',
        '259868373046787027306824157102080/367245835654354723613317470262923',
        '18273492977385001909516955936337745330891708575775/1801231189685318319154812955031946280708348672221069',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [5, -0.006217120994739359],
            [5, 9.99378287900526],
            [-5, 9.99378287900526],
            [-5, -0.006217120994739359],
          ],
          exactPoints: [
            ['5', '-13/2091'],
            ['5', '20897/2091'],
            ['-5', '20897/2091'],
            ['-5', '-13/2091'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        -0.7076142131979695,
        -0.7065989847715736,
        0,
        0,
        0.7065989847715736,
        -0.7076142131979695,
        0,
        0,
        7.065989847715736,
        -0.01014500142015454,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '-697/985',
        '696/985',
        '1392/197',
        '0',
        '-696/985',
        '-697/985',
        '-1393/137309',
        '1',
      ],
      tags: [],
    },
  ]);
});
