import { faces } from './faces.js';
import { initCgal } from './getCgal.js';

import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('Faces', (t) => {
  const results = faces([
    {
      type: 'graph',
      matrix: [
        1,
        0,
        0,
        0,
        0,
        7.076142131979695,
        7.065989847715736,
        0,
        0,
        -0.7065989847715736,
        0.7076142131979695,
        0,
        5,
        -3.5380710659898473,
        -3.532994923857868,
        1,
        '1',
        '0',
        '0',
        '5',
        '0',
        '1394/197',
        '-696/985',
        '-697/197',
        '0',
        '1392/197',
        '697/985',
        '-696/197',
        '1',
      ],
      tags: [],
      graph: {
        isClosed: true,
        isEmpty: false,
        isLazy: true,
        provenance: 'algorithm/cgal/fromSurfaceMeshToLazyGraph',
        serializedSurfaceMesh:
          '8\n' +
          '-10 1 -5\n' +
          '0 1 -5\n' +
          '0 0 -5\n' +
          '-10 0 -5\n' +
          '-10 1 5\n' +
          '0 1 5\n' +
          '0 0 5\n' +
          '-10 0 5\n' +
          '\n' +
          '12\n' +
          '3 2 3 0\n' +
          '3 0 1 2\n' +
          '3 7 6 4\n' +
          '3 5 4 6\n' +
          '3 4 3 7\n' +
          '3 3 4 0\n' +
          '3 5 0 4\n' +
          '3 0 5 1\n' +
          '3 6 1 5\n' +
          '3 1 6 2\n' +
          '3 7 2 6\n' +
          '3 2 7 3\n' +
          '',
        hash: 'UrrFjxNGlYnRuSBlWQN3MkTQysJls2S9awXoove14Lc=',
      },
      cache: {
        boundingBox: [
          [-5.000000000000026, -7.071065989847738, -7.071065989847738],
          [5.0000000000000195, 7.071065989847745, 7.071065989847744],
        ],
      },
    },
  ]);
  console.log(JSON.stringify(results));
  t.deepEqual(JSON.parse(JSON.stringify(results)), [
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [-5.000000000000001, -9.992826398852223],
            [5.000000000000001, -9.992826398852223],
            [5.000000000000001, 0.007173601147776184],
            [-5.000000000000001, 0.007173601147776184],
          ],
          exactPoints: [
            [
              '-232202547395424126636300831222658159179749864028407044849532928197/46440509479084815486387325036943093524542562636679444122700873728',
              '-88291864305896180558907876160043663/8835524683590758928432021341470720',
            ],
            [
              '232202547395424126636300831222658159179749864028407044849532928197/46440509479084815486387325036943093524542562636679444122700873728',
              '-88291864305896180558907876160043663/8835524683590758928432021341470720',
            ],
            [
              '232202547395424126636300831222658159179749864028407044849532928197/46440509479084815486387325036943093524542562636679444122700873728',
              '63382530011411472045159997243391/8835524683590758928432021341470720',
            ],
            [
              '-232202547395424126636300831222658159179749864028407044849532928197/46440509479084815486387325036943093524542562636679444122700873728',
              '63382530011411472045159997243391/8835524683590758928432021341470720',
            ],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        0.9999999999999998,
        0,
        0,
        0,
        0,
        -0.7065989847715736,
        0.7076142131979695,
        0,
        0,
        -0.7076142131979695,
        -0.7065989847715736,
        0,
        0,
        -7.06599713055954,
        0,
        1,
        '232202547395424077431936625184715467622712813183397220613504368640/232202547395424126636300831222658159179749864028407044849532928197',
        '0',
        '0',
        '0',
        '0',
        '-8822848177588476634417054309416960/12486358412248059992896519456948027',
        '-8835524683590758928432021341470720/12486358412248059992896519456948027',
        '-4925/697',
        '0',
        '8835524683590758928432021341470720/12486358412248059992896519456948027',
        '-8822848177588476634417054309416960/12486358412248059992896519456948027',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [-7.071065989847716, 0.005076142131979695],
            [-0.005076142131979695, -7.071065989847716],
            [7.071065989847716, -0.005076142131979695],
            [0.005076142131979695, 7.071065989847716],
          ],
          exactPoints: [
            ['-1393/197', '1/197'],
            ['-1/197', '-1393/197'],
            ['1393/197', '-1/197'],
            ['1/197', '1393/197'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        0,
        0,
        -1,
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        0,
        5,
        0,
        0,
        1,
        '0',
        '0',
        '1',
        '5',
        '0',
        '1',
        '0',
        '0',
        '-1',
        '0',
        '0',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [-5, -9.992826398852223],
            [5, -9.992826398852223],
            [5, 0.007173601147776184],
            [-5, 0.007173601147776184],
          ],
          exactPoints: [
            [
              '-1350631426199681393181260241809272387418694186537663546394379550917/270126285239936268795379207154265939172331427138530744431670198272',
              '-88291864305896180558907876160043663/8835524683590758928432021341470720',
            ],
            [
              '1350631426199681393181260241809272387418694186537663546394379550917/270126285239936268795379207154265939172331427138530744431670198272',
              '-88291864305896180558907876160043663/8835524683590758928432021341470720',
            ],
            [
              '1350631426199681393181260241809272387418694186537663546394379550917/270126285239936268795379207154265939172331427138530744431670198272',
              '63382530011411472045159997243391/8835524683590758928432021341470720',
            ],
            [
              '-1350631426199681393181260241809272387418694186537663546394379550917/270126285239936268795379207154265939172331427138530744431670198272',
              '63382530011411472045159997243391/8835524683590758928432021341470720',
            ],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        0.9999999999999999,
        0,
        0,
        0,
        0,
        0.7065989847715736,
        -0.7076142131979695,
        0,
        0,
        0.7076142131979695,
        0.7065989847715736,
        0,
        0,
        7.06599713055954,
        0,
        1,
        '1350631426199681343976896035771329695861657135692653722158350991360/1350631426199681393181260241809272387418694186537663546394379550917',
        '0',
        '0',
        '0',
        '0',
        '8822848177588476634417054309416960/12486358412248059992896519456948027',
        '8835524683590758928432021341470720/12486358412248059992896519456948027',
        '4925/697',
        '0',
        '-8835524683590758928432021341470720/12486358412248059992896519456948027',
        '8822848177588476634417054309416960/12486358412248059992896519456948027',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [0.005076142131979695, -7.071065989847716],
            [7.071065989847716, 0.005076142131979695],
            [-0.005076142131979695, 7.071065989847716],
            [-7.071065989847716, -0.005076142131979695],
          ],
          exactPoints: [
            ['1/197', '-1393/197'],
            ['1393/197', '1/197'],
            ['-1/197', '1393/197'],
            ['-1393/197', '-1/197'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        0,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        -1,
        0,
        0,
        0,
        -5,
        0,
        0,
        1,
        '0',
        '0',
        '-1',
        '-5',
        '0',
        '1',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        0.9999999999999999,
        0,
        0,
        0,
        0,
        0.7076142131979695,
        0.7065989847715735,
        0,
        0,
        -0.7065989847715735,
        0.7076142131979695,
        0,
        0,
        0,
        7.06599713055954,
        1,
        '337858723805452716624103500345332936766236242009221715772655534080/337858723805452748255480489941157578605876031989089803242104160453',
        '0',
        '0',
        '0',
        '0',
        '259868373046787027306824157102080/367245835654354723613317470262923',
        '-1470474696264746105736175718236160/2081059735374676767142132331489897',
        '0',
        '0',
        '1470474696264746105736175718236160/2081059735374676767142132331489897',
        '259868373046787027306824157102080/367245835654354723613317470262923',
        '4925/697',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        -0.7076142131979695,
        -0.7065989847715736,
        0,
        0,
        0.7065989847715736,
        -0.7076142131979695,
        0,
        0,
        0,
        -7.06599713055954,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '-697/985',
        '696/985',
        '0',
        '0',
        '-696/985',
        '-697/985',
        '-4925/697',
        '1',
      ],
      tags: [],
    },
  ]);

  if (false)
    t.deepEqual(JSON.parse(JSON.stringify(results)), [
      {
        type: 'polygonsWithHoles',
        polygonsWithHoles: [
          {
            points: [
              [-10, -5],
              [0, -5],
              [0, 5],
              [-10, 5],
            ],
            exactPoints: [
              ['-10', '-5'],
              ['0', '-5'],
              ['0', '5'],
              ['-10', '5'],
            ],
            holes: [],
          },
        ],
        plane: [0, -1, 0, 0],
        exactPlane: ['0', '-1', '0', '0'],
        matrix: [
          1,
          0,
          0,
          0,
          0,
          7.076142131979695,
          7.065989847715736,
          0,
          0,
          -0.7065989847715736,
          0.7076142131979695,
          0,
          5,
          -3.5380710659898473,
          -3.532994923857868,
          1,
          '1',
          '0',
          '0',
          '5',
          '0',
          '1394/197',
          '-696/985',
          '-697/197',
          '0',
          '1392/197',
          '697/985',
          '-696/197',
          '1',
        ],
        tags: [],
      },
      {
        type: 'polygonsWithHoles',
        polygonsWithHoles: [
          {
            points: [
              [1, 5],
              [0, 5],
              [0, -5],
              [1, -5],
            ],
            exactPoints: [
              ['1', '5'],
              ['0', '5'],
              ['0', '-5'],
              ['1', '-5'],
            ],
            holes: [],
          },
        ],
        plane: [1, 0, 0, 0],
        exactPlane: ['1', '0', '0', '0'],
        matrix: [
          1,
          0,
          0,
          0,
          0,
          7.076142131979695,
          7.065989847715736,
          0,
          0,
          -0.7065989847715736,
          0.7076142131979695,
          0,
          5,
          -3.5380710659898473,
          -3.532994923857868,
          1,
          '1',
          '0',
          '0',
          '5',
          '0',
          '1394/197',
          '-696/985',
          '-697/197',
          '0',
          '1392/197',
          '697/985',
          '-696/197',
          '1',
        ],
        tags: [],
      },
      {
        type: 'polygonsWithHoles',
        polygonsWithHoles: [
          {
            points: [
              [-10, -5],
              [0, -5],
              [0, 5],
              [-10, 5],
            ],
            exactPoints: [
              ['-10', '-5'],
              ['0', '-5'],
              ['0', '5'],
              ['-10', '5'],
            ],
            holes: [],
          },
        ],
        plane: [0, 1, 0, -1],
        exactPlane: ['0', '1', '0', '-1'],
        matrix: [
          1,
          0,
          0,
          0,
          0,
          7.076142131979695,
          7.065989847715736,
          0,
          0,
          -0.7065989847715736,
          0.7076142131979695,
          0,
          5,
          -3.5380710659898473,
          -3.532994923857868,
          1,
          '1',
          '0',
          '0',
          '5',
          '0',
          '1394/197',
          '-696/985',
          '-697/197',
          '0',
          '1392/197',
          '697/985',
          '-696/197',
          '1',
        ],
        tags: [],
      },
      {
        type: 'polygonsWithHoles',
        polygonsWithHoles: [
          {
            points: [
              [0, -5],
              [1, -5],
              [1, 5],
              [0, 5],
            ],
            exactPoints: [
              ['0', '-5'],
              ['1', '-5'],
              ['1', '5'],
              ['0', '5'],
            ],
            holes: [],
          },
        ],
        plane: [-1, 0, 0, -10],
        exactPlane: ['-1', '0', '0', '-10'],
        matrix: [
          1,
          0,
          0,
          0,
          0,
          7.076142131979695,
          7.065989847715736,
          0,
          0,
          -0.7065989847715736,
          0.7076142131979695,
          0,
          5,
          -3.5380710659898473,
          -3.532994923857868,
          1,
          '1',
          '0',
          '0',
          '5',
          '0',
          '1394/197',
          '-696/985',
          '-697/197',
          '0',
          '1392/197',
          '697/985',
          '-696/197',
          '1',
        ],
        tags: [],
      },
      {
        type: 'polygonsWithHoles',
        polygonsWithHoles: [],
        plane: [0, 0, 1, -5],
        exactPlane: ['0', '0', '1', '-5'],
        matrix: [
          1,
          0,
          0,
          0,
          0,
          7.076142131979695,
          7.065989847715736,
          0,
          0,
          -0.7065989847715736,
          0.7076142131979695,
          0,
          5,
          -3.5380710659898473,
          -3.532994923857868,
          1,
          '1',
          '0',
          '0',
          '5',
          '0',
          '1394/197',
          '-696/985',
          '-697/197',
          '0',
          '1392/197',
          '697/985',
          '-696/197',
          '1',
        ],
        tags: [],
      },
      {
        type: 'polygonsWithHoles',
        polygonsWithHoles: [],
        plane: [0, 0, -1, -5],
        exactPlane: ['0', '0', '-1', '-5'],
        matrix: [
          1,
          0,
          0,
          0,
          0,
          7.076142131979695,
          7.065989847715736,
          0,
          0,
          -0.7065989847715736,
          0.7076142131979695,
          0,
          5,
          -3.5380710659898473,
          -3.532994923857868,
          1,
          '1',
          '0',
          '0',
          '5',
          '0',
          '1394/197',
          '-696/985',
          '-697/197',
          '0',
          '1392/197',
          '697/985',
          '-696/197',
          '1',
        ],
        tags: [],
      },
    ]);
});
