import { fill } from './fill.js';
import { initCgal } from './getCgal.js';

import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('Fill Segments', (t) => {
  const filled = fill([
    {
      type: 'segments',
      segments: [
        [
          [1.02, -0.83, 0.0],
          [-1.09, -0.72, 0.0],
        ],
        [
          [-0.8, -1.03, 0.0],
          [-0.75, 0.9, 0.0],
        ],
        [
          [-1.15, 0.39, 0.0],
          [1.34, 0.37, 0.0],
        ],
        [
          [0.51, 0.97, 0.0],
          [0.72, -1.31, 0.0],
        ],
        [
          [0.4, -0.52, 0.0],
          [-0.53, -0.47, 0.0],
        ],
        [
          [-0.4, -0.59, 0.0],
          [-0.41, 0.14, -0.0],
        ],
        [
          [-0.5, -0.04, -0.0],
          [0.35, 0.0, -0.0],
        ],
        [
          [0.18, 0.11, 0.0],
          [0.22, -0.64, 0.0],
        ],
      ],
    },
  ]);
  t.deepEqual(JSON.parse(JSON.stringify(filled)), [
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [0.6741287048060655, -0.8119687950372829],
            [0.5646895822316235, 0.3762273929138022],
            [-0.7632929036553144, 0.38689391890486197],
            [-0.7923708862622002, -0.7355162097209279],
          ],
          exactPoints: [
            [
              '294814658345503741587176624163718105885357329703/437326961815572769938084563157973625331456671744',
              '-177547923111353247353142758618890164668060351735/218663480907786384969042281578986812665728335872',
            ],
            [
              '58523713889541877618619336002788143327014242311/103638734857227653974076293321678239286264070144',
              '77983462040439117777665948150461262714267570911/207277469714455307948152586643356478572528140288',
            ],
            [
              '-13405331468090241339391914682599712930132472951/17562499800396128030610579165850973869533298688',
              '27179297494164456715324336286934505165591346011/70249999201584512122442316663403895478133194752',
            ],
            [
              '-134461895940461301419725813339733008634272099/169695654234281217318892565641749310191173632',
              '-124813904408511654584195093643037842595546297/169695654234281217318892565641749310191173632',
            ],
          ],
          holes: [
            {
              points: [
                [-0.40154923349056604, -0.4769059551886792],
                [-0.40759381542921563, -0.035651473667257204],
                [0.18627757784384288, -0.007704584572054451],
                [0.21306398274622573, -0.5099496764917325],
              ],
              exactPoints: [
                [
                  '-398129122526948621934128921636396380960258860291/991482710765284570441286821967739185104754311168',
                  '-236422004615289504211273904257149115680163884857/495741355382642285220643410983869592552377155584',
                ],
                [
                  '-5917912429880291585062701552734731191724852346093/14519141865900121175068247069228458679529990258688',
                  '-517628803903309844247718019526381462908892183345/14519141865900121175068247069228458679529990258688',
                ],
                [
                  '88376772025012818285130546113125201624722930363/474435909291773992852386221450896667983266971648',
                  '-263183874275377939170681146257188567830217614575/34159385469007727485371807944464560094795221958656',
                ],
                [
                  '3465185306072275107186381918110188514389459534323/16263590220218288781676947008335650462646027681792',
                  '-4146806285697211052760987184740246406050293516033/8131795110109144390838473504167825231323013840896',
                ],
              ],
              holes: [],
            },
          ],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
  ]);
});

test('Fill', (t) => {
  const filled = fill([
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [-0.8660254037844385, -0.5000000000000003],
            [0.8660254037844387, -0.49999999999999983],
            [6.123233995736766e-17, 1],
          ],
          exactPoints: [
            [
              '-7800463371553961/9007199254740992',
              '-4503599627370499/9007199254740992',
            ],
            [
              '7800463371553963/9007199254740992',
              '-9007199254740989/18014398509481984',
            ],
            ['4967757600021511/81129638414606681695789005144064', '1'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [-0.8660254037844385, -0.5000000000000003],
            [0.8660254037844387, -0.49999999999999983],
            [6.123233995736766e-17, 1],
          ],
          exactPoints: [
            [
              '-7800463371553961/9007199254740992',
              '-4503599627370499/9007199254740992',
            ],
            [
              '7800463371553963/9007199254740992',
              '-9007199254740989/18014398509481984',
            ],
            ['4967757600021511/81129638414606681695789005144064', '1'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        0.5,
        0,
        0,
        0,
        0,
        0.5,
        0,
        0,
        0,
        0,
        0.5,
        0,
        0,
        0,
        0,
        1,
        '1/2',
        '0',
        '0',
        '0',
        '0',
        '1/2',
        '0',
        '0',
        '0',
        '0',
        '1/2',
        '0',
        '1',
      ],
      tags: [],
    },
  ]);
  t.deepEqual(JSON.parse(JSON.stringify(filled)), [
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [6.123233995736766e-17, 1],
            [-0.8660254037844385, -0.5000000000000003],
            [0.8660254037844387, -0.49999999999999983],
          ],
          exactPoints: [
            ['4967757600021511/81129638414606681695789005144064', '1'],
            [
              '-7800463371553961/9007199254740992',
              '-4503599627370499/9007199254740992',
            ],
            [
              '7800463371553963/9007199254740992',
              '-9007199254740989/18014398509481984',
            ],
          ],
          holes: [
            {
              points: [
                [-0.43301270189221924, -0.25000000000000017],
                [3.061616997868383e-17, 0.5],
                [0.43301270189221935, -0.24999999999999992],
              ],
              exactPoints: [
                [
                  '-7800463371553961/18014398509481984',
                  '-4503599627370499/18014398509481984',
                ],
                ['4967757600021511/162259276829213363391578010288128', '1/2'],
                [
                  '7800463371553963/18014398509481984',
                  '-9007199254740989/36028797018963968',
                ],
              ],
              holes: [],
            },
          ],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
  ]);
});
