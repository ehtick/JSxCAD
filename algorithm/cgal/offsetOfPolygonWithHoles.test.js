import { initCgal } from './getCgal.js';
import { offsetOfPolygonWithHoles } from './offsetOfPolygonWithHoles.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('offsetOfPolygon/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const offset = offsetOfPolygonWithHoles(0.1, 0.05, 0.5, 8, {
    plane: xyPlane,
    points: polygon,
    holes: [],
  });
  t.deepEqual(JSON.parse(JSON.stringify(offset)), [
    {
      points: [
        [-0.3894736842105263, -0.5, 0],
        [-0.3609022556390977, -0.5714285714285714, 0],
        [-0.28947368421052627, -0.6, 0],
        [-0.21804511278195488, -0.5714285714285714, 0],
        [0.25, -0.3017704115265091, 0],
        [0.7180451127819548, -0.5714285714285714, 0],
        [0.7894736842105262, -0.6, 0],
        [0.8609022556390977, -0.5714285714285714, 0],
        [0.8894736842105263, -0.5, 0],
        [0.8894736842105263, 0.5, 0],
        [0.8609022556390977, 0.5714285714285714, 0],
        [0.7894736842105262, 0.6, 0],
        [0.7180451127819548, 0.5714285714285714, 0],
        [0.25, 0.3017704115265091, 0],
        [-0.21804511278195488, 0.5714285714285714, 0],
        [-0.28947368421052627, 0.6, 0],
        [-0.3609022556390977, 0.5714285714285714, 0],
        [-0.3894736842105263, 0.5, 0],
      ],
      exactPoints: [
        ['-37/95', '-1/2', '0'],
        ['-48/133', '-4/7', '0'],
        ['-11/38', '-3/5', '0'],
        ['-29/133', '-4/7', '0'],
        ['1/4', '-6409/21238', '0'],
        ['191/266', '-4/7', '0'],
        ['15/19', '-3/5', '0'],
        ['229/266', '-4/7', '0'],
        ['169/190', '-1/2', '0'],
        ['169/190', '1/2', '0'],
        ['229/266', '4/7', '0'],
        ['15/19', '3/5', '0'],
        ['191/266', '4/7', '0'],
        ['1/4', '6409/21238', '0'],
        ['-29/133', '4/7', '0'],
        ['-11/38', '3/5', '0'],
        ['-48/133', '4/7', '0'],
        ['-37/95', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.4394736842105263, -0.5, 0],
        [-0.3947368421052631, -0.6052631578947368, 0],
        [-0.28947368421052627, -0.6499999999999999, 0],
        [-0.18421052631578946, -0.6052631578947368, 0],
        [0.25, -0.3550983589494501, 0],
        [0.6842105263157894, -0.6052631578947368, 0],
        [0.7894736842105262, -0.6499999999999999, 0],
        [0.894736842105263, -0.6052631578947368, 0],
        [0.9394736842105262, -0.5, 0],
        [0.9394736842105262, 0.5, 0],
        [0.894736842105263, 0.6052631578947368, 0],
        [0.7894736842105262, 0.6499999999999999, 0],
        [0.6842105263157894, 0.6052631578947368, 0],
        [0.25, 0.3550983589494501, 0],
        [-0.18421052631578946, 0.6052631578947368, 0],
        [-0.28947368421052627, 0.6499999999999999, 0],
        [-0.3947368421052631, 0.6052631578947368, 0],
        [-0.4394736842105263, 0.5, 0],
      ],
      exactPoints: [
        ['-167/380', '-1/2', '0'],
        ['-15/38', '-23/38', '0'],
        ['-11/38', '-13/20', '0'],
        ['-7/38', '-23/38', '0'],
        ['1/4', '-10235/28823', '0'],
        ['13/19', '-23/38', '0'],
        ['15/19', '-13/20', '0'],
        ['17/19', '-23/38', '0'],
        ['357/380', '-1/2', '0'],
        ['357/380', '1/2', '0'],
        ['17/19', '23/38', '0'],
        ['15/19', '13/20', '0'],
        ['13/19', '23/38', '0'],
        ['1/4', '10235/28823', '0'],
        ['-7/38', '23/38', '0'],
        ['-11/38', '13/20', '0'],
        ['-15/38', '23/38', '0'],
        ['-167/380', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.4894736842105263, -0.5, 0],
        [-0.43009868421052627, -0.640625, 0],
        [-0.28947368421052627, -0.7, 0],
        [-0.1488486842105263, -0.640625, 0],
        [0.25, -0.41083347066578774, 0],
        [0.6488486842105262, -0.640625, 0],
        [0.7894736842105262, -0.7, 0],
        [0.9300986842105262, -0.640625, 0],
        [0.9894736842105263, -0.5, 0],
        [0.9894736842105263, 0.5, 0],
        [0.9300986842105262, 0.640625, 0],
        [0.7894736842105262, 0.7, 0],
        [0.6488486842105262, 0.640625, 0],
        [0.25, 0.41083347066578774, 0],
        [-0.1488486842105263, 0.640625, 0],
        [-0.28947368421052627, 0.7, 0],
        [-0.43009868421052627, 0.640625, 0],
        [-0.4894736842105263, 0.5, 0],
      ],
      exactPoints: [
        ['-93/190', '-1/2', '0'],
        ['-523/1216', '-41/64', '0'],
        ['-11/38', '-7/10', '0'],
        ['-181/1216', '-41/64', '0'],
        ['1/4', '-39887/97088', '0'],
        ['789/1216', '-41/64', '0'],
        ['15/19', '-7/10', '0'],
        ['1131/1216', '-41/64', '0'],
        ['94/95', '-1/2', '0'],
        ['94/95', '1/2', '0'],
        ['1131/1216', '41/64', '0'],
        ['15/19', '7/10', '0'],
        ['789/1216', '41/64', '0'],
        ['1/4', '39887/97088', '0'],
        ['-181/1216', '41/64', '0'],
        ['-11/38', '7/10', '0'],
        ['-523/1216', '41/64', '0'],
        ['-93/190', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.5394736842105262, -0.5, 0],
        [-0.46594427244582043, -0.676470588235294, 0],
        [-0.28947368421052627, -0.75, 0],
        [-0.11300309597523218, -0.676470588235294, 0],
        [0.25, -0.46733103261080305, 0],
        [0.6130030959752322, -0.676470588235294, 0],
        [0.7894736842105262, -0.75, 0],
        [0.9659442724458204, -0.676470588235294, 0],
        [1.039473684210526, -0.5, 0],
        [1.039473684210526, 0.5, 0],
        [0.9659442724458204, 0.676470588235294, 0],
        [0.7894736842105262, 0.75, 0],
        [0.6130030959752322, 0.676470588235294, 0],
        [0.25, 0.46733103261080305, 0],
        [-0.11300309597523218, 0.676470588235294, 0],
        [-0.28947368421052627, 0.75, 0],
        [-0.46594427244582043, 0.676470588235294, 0],
        [-0.5394736842105262, 0.5, 0],
      ],
      exactPoints: [
        ['-41/76', '-1/2', '0'],
        ['-301/646', '-23/34', '0'],
        ['-11/38', '-3/4', '0'],
        ['-73/646', '-23/34', '0'],
        ['1/4', '-12052/25789', '0'],
        ['198/323', '-23/34', '0'],
        ['15/19', '-3/4', '0'],
        ['312/323', '-23/34', '0'],
        ['79/76', '-1/2', '0'],
        ['79/76', '1/2', '0'],
        ['312/323', '23/34', '0'],
        ['15/19', '3/4', '0'],
        ['198/323', '23/34', '0'],
        ['1/4', '12052/25789', '0'],
        ['-73/646', '23/34', '0'],
        ['-11/38', '3/4', '0'],
        ['-301/646', '23/34', '0'],
        ['-41/76', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.5894736842105263, -0.5, 0],
        [-0.5015948963317384, -0.712121212121212, 0],
        [-0.28947368421052627, -0.7999999999999999, 0],
        [-0.07735247208931419, -0.712121212121212, 0],
        [0.25, -0.5235213040091088, 0],
        [0.5773524720893142, -0.712121212121212, 0],
        [0.7894736842105262, -0.7999999999999999, 0],
        [1.0015948963317383, -0.712121212121212, 0],
        [1.0894736842105261, -0.5, 0],
        [1.0894736842105261, 0.5, 0],
        [1.0015948963317383, 0.712121212121212, 0],
        [0.7894736842105262, 0.7999999999999999, 0],
        [0.5773524720893142, 0.712121212121212, 0],
        [0.25, 0.5235213040091088, 0],
        [-0.07735247208931419, 0.712121212121212, 0],
        [-0.28947368421052627, 0.7999999999999999, 0],
        [-0.5015948963317384, 0.712121212121212, 0],
        [-0.5894736842105263, 0.5, 0],
      ],
      exactPoints: [
        ['-56/95', '-1/2', '0'],
        ['-629/1254', '-47/66', '0'],
        ['-11/38', '-4/5', '0'],
        ['-97/1254', '-47/66', '0'],
        ['1/4', '-8736/16687', '0'],
        ['362/627', '-47/66', '0'],
        ['15/19', '-4/5', '0'],
        ['628/627', '-47/66', '0'],
        ['207/190', '-1/2', '0'],
        ['207/190', '1/2', '0'],
        ['628/627', '47/66', '0'],
        ['15/19', '4/5', '0'],
        ['362/627', '47/66', '0'],
        ['1/4', '8736/16687', '0'],
        ['-97/1254', '47/66', '0'],
        ['-11/38', '4/5', '0'],
        ['-629/1254', '47/66', '0'],
        ['-56/95', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.6394736842105263, -0.5, 0],
        [-0.5360490266762797, -0.7465753424657534, 0],
        [-0.28947368421052627, -0.85, 0],
        [-0.04289834174477289, -0.7465753424657534, 0],
        [0.25, -0.5778257375317181, 0],
        [0.5428983417447728, -0.7465753424657534, 0],
        [0.7894736842105262, -0.85, 0],
        [1.0360490266762796, -0.7465753424657534, 0],
        [1.1394736842105262, -0.5, 0],
        [1.1394736842105262, 0.5, 0],
        [1.0360490266762796, 0.7465753424657534, 0],
        [0.7894736842105262, 0.85, 0],
        [0.5428983417447728, 0.7465753424657534, 0],
        [0.25, 0.5778257375317181, 0],
        [-0.04289834174477289, 0.7465753424657534, 0],
        [-0.28947368421052627, 0.85, 0],
        [-0.5360490266762797, 0.7465753424657534, 0],
        [-0.6394736842105263, 0.5, 0],
      ],
      exactPoints: [
        ['-243/380', '-1/2', '0'],
        ['-1487/2774', '-109/146', '0'],
        ['-11/38', '-17/20', '0'],
        ['-119/2774', '-109/146', '0'],
        ['1/4', '-63989/110741', '0'],
        ['753/1387', '-109/146', '0'],
        ['15/19', '-17/20', '0'],
        ['1437/1387', '-109/146', '0'],
        ['433/380', '-1/2', '0'],
        ['433/380', '1/2', '0'],
        ['1437/1387', '109/146', '0'],
        ['15/19', '17/20', '0'],
        ['753/1387', '109/146', '0'],
        ['1/4', '63989/110741', '0'],
        ['-119/2774', '109/146', '0'],
        ['-11/38', '17/20', '0'],
        ['-1487/2774', '109/146', '0'],
        ['-243/380', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.6894736842105262, -0.5, 0],
        [-0.5715249662618083, -0.782051282051282, 0],
        [-0.28947368421052627, -0.8999999999999999, 0],
        [-0.007422402159244264, -0.782051282051282, 0],
        [0.25, -0.6337406825211702, 0],
        [0.5074224021592442, -0.782051282051282, 0],
        [0.7894736842105262, -0.8999999999999999, 0],
        [1.0715249662618083, -0.782051282051282, 0],
        [1.1894736842105262, -0.5, 0],
        [1.1894736842105262, 0.5, 0],
        [1.0715249662618083, 0.782051282051282, 0],
        [0.7894736842105262, 0.8999999999999999, 0],
        [0.5074224021592442, 0.782051282051282, 0],
        [0.25, 0.6337406825211702, 0],
        [-0.007422402159244264, 0.782051282051282, 0],
        [-0.28947368421052627, 0.8999999999999999, 0],
        [-0.5715249662618083, 0.782051282051282, 0],
        [-0.6894736842105262, 0.5, 0],
      ],
      exactPoints: [
        ['-131/190', '-1/2', '0'],
        ['-847/1482', '-61/78', '0'],
        ['-11/38', '-9/10', '0'],
        ['-11/1482', '-61/78', '0'],
        ['1/4', '-12498/19721', '0'],
        ['376/741', '-61/78', '0'],
        ['15/19', '-9/10', '0'],
        ['794/741', '-61/78', '0'],
        ['113/95', '-1/2', '0'],
        ['113/95', '1/2', '0'],
        ['794/741', '61/78', '0'],
        ['15/19', '9/10', '0'],
        ['376/741', '61/78', '0'],
        ['1/4', '12498/19721', '0'],
        ['-11/1482', '61/78', '0'],
        ['-11/38', '9/10', '0'],
        ['-847/1482', '61/78', '0'],
        ['-131/190', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.7394736842105263, -0.5, 0],
        [-0.6076555023923444, -0.8181818181818181, 0],
        [-0.28947368421052627, -0.95, 0],
        [0.028708133971291863, -0.8181818181818181, 0],
        [0.25, -0.6906873614190687, 0],
        [0.4712918660287081, -0.8181818181818181, 0],
        [0.7894736842105262, -0.95, 0],
        [1.1076555023923444, -0.8181818181818181, 0],
        [1.2394736842105263, -0.5, 0],
        [1.2394736842105263, 0.5, 0],
        [1.1076555023923444, 0.8181818181818181, 0],
        [0.7894736842105262, 0.95, 0],
        [0.4712918660287081, 0.8181818181818181, 0],
        [0.25, 0.6906873614190687, 0],
        [0.028708133971291863, 0.8181818181818181, 0],
        [-0.28947368421052627, 0.95, 0],
        [-0.6076555023923444, 0.8181818181818181, 0],
        [-0.7394736842105263, 0.5, 0],
      ],
      exactPoints: [
        ['-281/380', '-1/2', '0'],
        ['-127/209', '-9/11', '0'],
        ['-11/38', '-19/20', '0'],
        ['6/209', '-9/11', '0'],
        ['1/4', '-623/902', '0'],
        ['197/418', '-9/11', '0'],
        ['15/19', '-19/20', '0'],
        ['463/418', '-9/11', '0'],
        ['471/380', '-1/2', '0'],
        ['471/380', '1/2', '0'],
        ['463/418', '9/11', '0'],
        ['15/19', '19/20', '0'],
        ['197/418', '9/11', '0'],
        ['1/4', '623/902', '0'],
        ['6/209', '9/11', '0'],
        ['-11/38', '19/20', '0'],
        ['-127/209', '9/11', '0'],
        ['-281/380', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.7894736842105262, -0.5, 0],
        [-0.6424148606811145, -0.8529411764705882, 0],
        [-0.28947368421052627, -1, 0],
        [0.06346749226006192, -0.8529411764705882, 0],
        [0.25, -0.7454728760324169, 0],
        [0.43653250773993807, -0.8529411764705882, 0],
        [0.7894736842105262, -1, 0],
        [1.1424148606811144, -0.8529411764705882, 0],
        [1.289473684210526, -0.5, 0],
        [1.289473684210526, 0.5, 0],
        [1.1424148606811144, 0.8529411764705882, 0],
        [0.7894736842105262, 1, 0],
        [0.43653250773993807, 0.8529411764705882, 0],
        [0.25, 0.7454728760324169, 0],
        [0.06346749226006192, 0.8529411764705882, 0],
        [-0.28947368421052627, 1, 0],
        [-0.6424148606811145, 0.8529411764705882, 0],
        [-0.7894736842105262, 0.5, 0],
      ],
      exactPoints: [
        ['-15/19', '-1/2', '0'],
        ['-415/646', '-29/34', '0'],
        ['-11/38', '-1', '0'],
        ['41/646', '-29/34', '0'],
        ['1/4', '-19225/25789', '0'],
        ['141/323', '-29/34', '0'],
        ['15/19', '-1', '0'],
        ['369/323', '-29/34', '0'],
        ['49/38', '-1/2', '0'],
        ['49/38', '1/2', '0'],
        ['369/323', '29/34', '0'],
        ['15/19', '1', '0'],
        ['141/323', '29/34', '0'],
        ['1/4', '19225/25789', '0'],
        ['41/646', '29/34', '0'],
        ['-11/38', '1', '0'],
        ['-415/646', '29/34', '0'],
        ['-15/19', '1/2', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
  ]);
});
