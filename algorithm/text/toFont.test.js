import { boot, read } from '@jsxcad/sys';

import { serialize } from '@jsxcad/geometry';
import test from 'ava';
import { toFont } from './toFont.js';

test('Render a letter', async (t) => {
  await boot();
  const bytes = await read('GreatVibes-Regular.ttf', {
    doSerialize: false,
    sources: ['GreatVibes-Regular.ttf'],
  });
  const font = toFont({}, bytes);
  const letterA = font({}, 'ab');
  t.deepEqual(JSON.parse(JSON.stringify(serialize(letterA))), {
    type: 'group',
    tags: [],
    content: [
      {
        type: 'polygonsWithHoles',
        polygonsWithHoles: [
          {
            points: [
              [0.28307812499999996, 0.09356406249999999],
              [0.3031, 0.13249999999999998],
              [0.3049998046875, 0.13741249999999997],
              [0.30478222656250004, 0.144059375],
              [0.30095058593749996, 0.14590625],
              [0.2955955078125, 0.14227812499999998],
              [0.293, 0.1382],
              [0.2763765625, 0.10606249999999999],
              [0.23885253906249998, 0.046746875],
              [0.21868449707031248, 0.02525234375],
              [0.20605310058593745, 0.01807109375],
              [0.2002, 0.0173],
              [0.19695390624999992, 0.0179462890625],
              [0.19226171874999995, 0.023190429687499996],
              [0.19035624999999998, 0.0413046875],
              [0.193, 0.0605],
              [0.19792539062499998, 0.07826835937499999],
              [0.214273046875, 0.11839882812499998],
              [0.244384375, 0.173871875],
              [0.25989999999999996, 0.1951],
              [0.2522281249999999, 0.19456874999999998],
              [0.2297, 0.19799999999999998],
              [0.22161445312499997, 0.1976638671875],
              [0.20823710937499998, 0.1920181640625],
              [0.19181562500000002, 0.1720828125],
              [0.1807, 0.15189999999999998],
              [0.16633906249999997, 0.12551874999999998],
              [0.13461718749999999, 0.07466874999999999],
              [0.1166, 0.0511],
              [0.103755859375, 0.037647070312499996],
              [0.078901953125, 0.021461523437499998],
              [0.063418701171875, 0.019703930664062497],
              [0.055755712890624996, 0.023952612304687503],
              [0.050939208984375, 0.0328343017578125],
              [0.04958559570312499, 0.046603295898437494],
              [0.0504, 0.0554],
              [0.05602187499999999, 0.07691406249999999],
              [0.073490625, 0.11641718749999998],
              [0.0799, 0.12819999999999998],
              [0.1012390625, 0.15963437499999997],
              [0.1379791015625, 0.201811328125],
              [0.16334355468749995, 0.22324960937499996],
              [0.1757, 0.23109999999999997],
              [0.1856427734375, 0.23555605468749996],
              [0.20467050781249996, 0.2387728515625],
              [0.22107792968749995, 0.2343255859375],
              [0.2330931640625, 0.22212988281249998],
              [0.2369, 0.21309999999999998],
              [0.24115644531249997, 0.21295214843749993],
              [0.2474240234375, 0.2159423828125],
              [0.24995566406249997, 0.22208730468749996],
              [0.2478607421875, 0.22991503906250002],
              [0.2448, 0.23399999999999999],
              [0.236642529296875, 0.24153952636718748],
              [0.21786547851562502, 0.25188596191406243],
              [0.19660053710937503, 0.25637829589843747],
              [0.17380161132812494, 0.2555637939453124],
              [0.150422607421875, 0.2499897216796875],
              [0.127417431640625, 0.24020334472656252],
              [0.10573999023437498, 0.22675192871093747],
              [0.086344189453125, 0.2101827392578125],
              [0.0778, 0.2009],
              [0.059284082031250004, 0.1765681884765625],
              [0.03296083984375, 0.12938405761718746],
              [0.01959150390625, 0.0861344970703125],
              [0.017587011718749997, 0.04917380371093749],
              [0.025358300781249996, 0.020856274414062497],
              [0.041316308593750004, 0.003536206054687498],
              [0.06387197265625, -0.00043210449218750104],
              [0.09143623046874999, 0.011305639648437497],
              [0.1066, 0.023799999999999998],
              [0.12185156249999998, 0.0402125],
              [0.1483796875, 0.075775],
              [0.15839999999999999, 0.0914],
              [0.152769140625, 0.0656455078125],
              [0.152384619140625, 0.036074926757812494],
              [0.15638510742187497, 0.0217747802734375],
              [0.16685507812499997, 0.007369726562500001],
              [0.185133984375, -0.0009439453124999999],
              [0.1944, -0.0014],
              [0.20250258789062503, 0.00021472167968749974],
              [0.218622216796875, 0.0085318603515625],
              [0.24208242187499995, 0.030973632812499995],
            ],
            exactPoints: [
              [
                '1991985216041779/7036874417766400',
                '1316797115657093/14073748835532800',
              ],
              ['8531506544099983/28147497671065600', '53/400'],
              [
                '8584981292116869/28147497671065600',
                '7735636047450603/56294995342131200',
              ],
              [
                '4289428506175079/14073748835532800',
                '2027455461153833/14073748835532800',
              ],
              [
                '8471005916781609/28147497671065600',
                '821379166413783/5629499534213120',
              ],
              [
                '8320273867729797/28147497671065600',
                '100119329802027/703687441776640',
              ],
              [
                '8247216817622221/28147497671065600',
                '1944992089070633/14073748835532800',
              ],
              [
                '3889654324652933/14073748835532800',
                '597078794347479/5629499534213120',
              ],
              ['48917/204800', '5263230220768379/112589990684262400'],
              [
                '6155421371984773/28147497671065600',
                '710790286892073/28147497671065600',
              ],
              [
                '5799879168858521/28147497671065600',
                '813849710786773/45035996273704960',
              ],
              [
                '5635129033747333/28147497671065600',
                '3895613677675479/225179981368524800',
              ],
              [
                '2771879808739573/14073748835532800',
                '8082290073455821/450359962737049600',
              ],
              [
                '5411686280750693/28147497671065600',
                '2611010262479667/112589990684262400',
              ],
              [
                '5358052103547781/28147497671065600',
                '465049438084137/11258999068426240',
              ],
              [
                '5432467050515661/28147497671065600',
                '272467777455915/4503599627370496',
              ],
              [
                '348194029478871/1759218604441600',
                '176244677058075/2251799813685248',
              ],
              [
                '6031250087886193/28147497671065600',
                '6665261477810667/56294995342131200',
              ],
              [
                '3439404313078661/14073748835532800',
                '489405819662631/2814749767106560',
              ],
              [
                '7315534644709949/28147497671065600',
                '5491576795624899/28147497671065600',
              ],
              [
                '3549795280507371/14073748835532800',
                '1095324687497429/5629499534213120',
              ],
              [
                '808185026880471/3518437208883200',
                '5573204538870989/28147497671065600',
              ],
              [
                '3118946151605207/14073748835532800',
                '5563743241313977/28147497671065600',
              ],
              [
                '1172270710232449/5629499534213120',
                '5404830825751511/28147497671065600',
              ],
              [
                '5399129857961493/28147497671065600',
                '605462570509271/3518437208883200',
              ],
              [
                '2543126414580777/14073748835532800',
                '8551209792469729/56294995342131200',
              ],
              [
                '936405674865197/5629499534213120',
                '7066077446600131/56294995342131200',
              ],
              [
                '3789136971641651/28147497671065600',
                '4203476933452759/56294995342131200',
              ],
              [
                '3281998228446249/28147497671065600',
                '5753348523965809/112589990684262400',
              ],
              [
                '1168187124046889/11258999068426240',
                '8477366591548293/225179981368524800',
              ],
              [
                '4441785083656929/56294995342131200',
                '604088180974551/28147497671065600',
              ],
              [
                '1785077743537357/28147497671065600',
                '2218465369910149/112589990684262400',
              ],
              [
                '3138767597474939/56294995342131200',
                '539364879249703/22517998136852480',
              ],
              [
                '5735245065014477/112589990684262400',
                '369681372903637/11258999068426240',
              ],
              [
                '1116568351657689/22517998136852480',
                '2623532325530501/56294995342131200',
              ],
              [
                '226981421219473/4503599627370496',
                '6237485483908137/112589990684262400',
              ],
              [
                '394218899022807/7036874417766400',
                '346390143214551/4503599627370496',
              ],
              [
                '4137154392065311/56294995342131200',
                '3276852514028257/28147497671065600',
              ],
              [
                '4497970127836283/56294995342131200',
                '360850920143061/2814749767106560',
              ],
              [
                '569925255187923/5629499534213120',
                '280831762408407/1759218604441600',
              ],
              [
                '3883766439886193/28147497671065600',
                '5680483888393093/28147497671065600',
              ],
              [
                '2298856162574991/14073748835532800',
                '6283917859949117/28147497671065600',
              ],
              [
                '2472757670403113/14073748835532800',
                '325244335589163/1407374883553280',
              ],
              [
                '522537953298219/2814749767106560',
                '6630313500721807/28147497671065600',
              ],
              [
                '5760962641988157/28147497671065600',
                '6720858283269161/28147497671065600',
              ],
              [
                '622279051100291/2814749767106560',
                '412229930277929/1759218604441600',
              ],
              [
                '6560989292590531/28147497671065600',
                '3126200179569459/14073748835532800',
              ],
              [
                '6668142198275441/28147497671065600',
                '5998231753704079/28147497671065600',
              ],
              [
                '1696987620699013/7036874417766400',
                '2997035051096473/14073748835532800',
              ],
              ['870545890434089/3518437208883200', '1769/8192'],
              [
                '3517813236034437/14073748835532800',
                '3125600945732321/14073748835532800',
              ],
              [
                '436041228966953/1759218604441600',
                '1617883256638669/7036874417766400',
              ],
              [
                '6890507429876859/28147497671065600',
                '131730289100587/562949953421312',
              ],
              [
                '3330447521129431/14073748835532800',
                '3399366627945349/14073748835532800',
              ],
              [
                '1533092012281037/7036874417766400',
                '443122470396887/1759218604441600',
              ],
              [
                '276690658020819/1407374883553280',
                '1804101871678259/7036874417766400',
              ],
              [
                '2446040225042923/14073748835532800',
                '7193481294884371/28147497671065600',
              ],
              [
                '8468039984165683/56294995342131200',
                '3518292554384671/14073748835532800',
              ],
              [
                '3586481860357653/28147497671065600',
                '3380561543136543/14073748835532800',
              ],
              [
                '5952632257721139/56294995342131200',
                '3191249692650373/14073748835532800',
              ],
              [
                '2430372871541883/28147497671065600',
                '2958059081878733/14073748835532800',
              ],
              [
                '1751900255047123/22517998136852480',
                '5654832282117079/28147497671065600',
              ],
              [
                '3337397121811743/56294995342131200',
                '993990534785663/5629499534213120',
              ],
              [
                '1484424260381311/45035996273704960',
                '1820918730226401/14073748835532800',
              ],
              [
                '1102903621147689/56294995342131200',
                '606117638921257/7036874417766400',
              ],
              [
                '495030371394519/28147497671065600',
                '27682390508621/562949953421312',
              ],
              [
                '2855090848729661/112589990684262400',
                '2348207741987717/112589990684262400',
              ],
              [
                '581475349959803/14073748835532800',
                '1592565627019591/450359962737049600',
              ],
              [
                '7191344806352651/112589990684262400',
                '-6227282016002391/14411518807585587200',
              ],
              [
                '1286850542085079/14073748835532800',
                '2545803725394411/225179981368524800',
              ],
              [
                '3000523251735593/28147497671065600',
                '535928355657089/22517998136852480',
              ],
              [
                '1714908285842227/14073748835532800',
                '2263762500195451/56294995342131200',
              ],
              [
                '8353033816679383/56294995342131200',
                '8531506544099983/112589990684262400',
              ],
              [
                '4458563631096791/28147497671065600',
                '643170321783849/7036874417766400',
              ],
              [
                '8600138059905761/56294995342131200',
                '147820542261461/2251799813685248',
              ],
              [
                '4289245712366961/28147497671065600',
                '1624670267039023/45035996273704960',
              ],
              [
                '440184944694657/2814749767106560',
                '2451622308138189/112589990684262400',
              ],
              [
                '2348276461464453/14073748835532800',
                '663805956013949/90071992547409920',
              ],
              [
                '651382299253801/3518437208883200',
                '-3400921406106501/3602879701896396800',
              ],
              [
                '5471873547255153/28147497671065600',
                '-1261007895663739/900719925474099200',
              ],
              [
                '227997644841445/1125899906842624',
                '3094465525212771/14411518807585587200',
              ],
              [
                '3076834169066619/14073748835532800',
                '7684816620014797/900719925474099200',
              ],
              [
                '3407007202966241/14073748835532800',
                '3487321029817139/112589990684262400',
              ],
            ],
            holes: [],
          },
        ],
        plane: [0, 0, 1, 0],
        exactPlane: ['0', '0', '1', '0'],
        matrix: [
          1,
          0,
          0,
          0,
          0,
          1,
          0,
          0,
          0,
          0,
          1,
          0,
          0,
          0,
          0,
          1,
          '1',
          '0',
          '0',
          '0',
          '0',
          '1',
          '0',
          '0',
          '0',
          '0',
          '1',
          '0',
          '1',
        ],
        tags: [],
      },
      {
        type: 'polygonsWithHoles',
        polygonsWithHoles: [
          {
            points: [
              [0.45320937499999997, 0.4259453125],
              [0.4406, 0.40969999999999995],
              [0.41599042968749994, 0.3698890625],
              [0.36116972656249996, 0.2684703125],
              [0.3050599609375, 0.1593640625],
              [0.2550767578125, 0.06822031249999999],
              [0.23469999999999996, 0.037399999999999996],
              [0.23297656249999998, 0.032529687499999994],
              [0.23654218749999997, 0.026501562499999996],
              [0.2405, 0.0281],
              [0.2538421875, 0.0450921875],
              [0.29293906249999996, 0.11170156249999998],
              [0.31679999999999997, 0.15619999999999998],
              [0.30658749999999996, 0.1345296875],
              [0.290475, 0.0946765625],
              [0.28509999999999996, 0.077],
              [0.28318847656249996, 0.0674100341796875],
              [0.2824474609375, 0.04920920410156249],
              [0.2859017578125, 0.0328558349609375],
              [0.2936544921874999, 0.0190003173828125],
              [0.3058087890625, 0.0082930419921875],
              [0.32246777343749994, 0.0013843994140625003],
              [0.34373457031250004, -0.0010752197265624995],
              [0.3697123046875, 0.0015645751953125],
              [0.3845, 0.004999999999999999],
              [0.3956457031250001, 0.00858173828125],
              [0.41668554687500003, 0.019082714843749994],
              [0.44480000000000003, 0.04185078124999999],
              [0.47496874999999994, 0.08158984374999999],
              [0.49553749999999996, 0.12686015625],
              [0.5017999999999999, 0.1498],
              [0.5041812499999999, 0.16704433593749998],
              [0.5015749999999999, 0.2000470703125],
              [0.49250820312499993, 0.22159323730468747],
              [0.48276054687500003, 0.2335232666015625],
              [0.469853515625, 0.24294138183593744],
              [0.453618359375, 0.24936359863281246],
              [0.4442, 0.25129999999999997],
              [0.43358203125, 0.25202656249999994],
              [0.42110234374999994, 0.24836093749999996],
              [0.41932890624999997, 0.24180781249999994],
              [0.42709921874999995, 0.23709218749999997],
              [0.4342, 0.2369],
              [0.4421772460937499, 0.237127587890625],
              [0.45514345703125, 0.234326123046875],
              [0.46437138671875, 0.22766098632812504],
              [0.47015634765625, 0.217706396484375],
              [0.47302421875, 0.19786289062499995],
              [0.46755390625000004, 0.165251171875],
              [0.46149999999999997, 0.14759999999999998],
              [0.45075624999999997, 0.12484374999999999],
              [0.42274375000000003, 0.07824375],
              [0.4075, 0.0583],
              [0.38953125, 0.038646875],
              [0.3658359374999999, 0.020727734374999997],
              [0.3519921875, 0.016789453125],
              [0.3456, 0.0173],
              [0.3373318603515625, 0.020235498046875],
              [0.32598522949218744, 0.031828759765625],
              [0.3208325439453125, 0.049877880859375],
              [0.32100310058593745, 0.072974267578125],
              [0.3293353515625, 0.114001171875],
              [0.3509498046874999, 0.17322226562499998],
              [0.36429999999999996, 0.2016],
              [0.383911328125, 0.238315234375],
              [0.42881523437499997, 0.31257070312499996],
              [0.493815625, 0.406434375],
              [0.5226999999999999, 0.4421],
              [0.515028125, 0.44151250000000003],
              [0.4925, 0.44499999999999995],
              [0.4889, 0.44499999999999995],
              [0.4829691406249999, 0.4447177734375],
              [0.47119179687499996, 0.4407830078124999],
            ],
            exactPoints: [
              [
                '3189177456829399/7036874417766400',
                '599464734579753/1407374883553280',
              ],
              [
                '775111717116969/1759218604441600',
                '1441503724479447/3518437208883200',
              ],
              [
                '2927272412703621/7036874417766400',
                '2602862881317847/7036874417766400',
              ],
              [
                '1270753004659671/3518437208883200',
                '1889191873961001/7036874417766400',
              ],
              [
                '2146668635005911/7036874417766400',
                '4485699578070303/28147497671065600',
              ],
              [
                '1794943111617577/7036874417766400',
                '768092434885247/11258999068426240',
              ],
              [
                '825777212924887/3518437208883200',
                '2105432825795707/56294995342131200',
              ],
              [
                '6557707250381619/28147497671065600',
                '3662517212586967/112589990684262400',
              ],
              [
                '1664517667941253/7036874417766400',
                '1193524269997359/45035996273704960',
              ],
              [
                '6769473189891277/28147497671065600',
                '6327557476455547/225179981368524800',
              ],
              [
                '446563898842153/1759218604441600',
                '2538464485279007/56294995342131200',
              ],
              [
                '824550157948289/2814749767106560',
                '1572059735161569/14073748835532800',
              ],
              [
                '4458563631096791/14073748835532800',
                '8793278272440893/56294995342131200',
              ],
              [
                '539354433889239/1759218604441600',
                '3786674065595433/28147497671065600',
              ],
              [
                '408807219300139/1407374883553280',
                '2664908322473247/28147497671065600',
              ],
              [
                '8024851586020803/28147497671065600',
                '1733885856537641/22517998136852480',
              ],
              ['57997/204800', '3794847560158413/56294995342131200'],
              [
                '3975094624468337/14073748835532800',
                '692557978921861/14073748835532800',
              ],
              ['1609483812436181/5629499534213120', '53831/1638400'],
              [
                '4132819567472803/14073748835532800',
                '4278491114257777/225179981368524800',
              ],
              [
                '860775217792811/2814749767106560',
                '7469708165156701/900719925474099200',
              ],
              [
                '453833045091287/1407374883553280',
                '623478068530381/450359962737049600',
              ],
              [
                '967526801733583/2814749767106560',
                '-121058978997207/112589990684262400',
              ],
              [
                '5203238117577851/14073748835532800',
                '5636976213281997/3602879701896396800',
              ],
              ['2705678213631181/7036874417766400', '1/200'],
              [
                '2784109126819513/7036874417766400',
                '1932435666281431/225179981368524800',
              ],
              [
                '293216386505769/703687441776640',
                '268565335811031/14073748835532800',
              ],
              [
                '626000348204499/1407374883553280',
                '4711979071066603/112589990684262400',
              ],
              [
                '6684590892226969/14073748835532800',
                '2296549936935731/28147497671065600',
              ],
              [
                '1394814062717567/2814749767106560',
                '7141591905195787/56294995342131200',
              ],
              [
                '7062207165670359/14073748835532800',
                '4216495151125627/28147497671065600',
              ],
              [
                '7095720280084971/14073748835532800',
                '4701880056765481/28147497671065600',
              ],
              [
                '1764760143045591/3518437208883200',
                '563082444572459/2814749767106560',
              ],
              [
                '346571837511041/703687441776640',
                '3118647565478789/14073748835532800',
              ],
              [
                '679425068442321/1407374883553280',
                '821636950350889/3518437208883200',
              ],
              ['48113/102400', '1709547994858127/7036874417766400'],
              [
                '3192055428515103/7036874417766400',
                '3509480655882813/14073748835532800',
              ],
              [
                '625155923274367/1407374883553280',
                '1414693232947757/5629499534213120',
              ],
              [
                '3051062303706317/7036874417766400',
                '3546958540507709/14073748835532800',
              ],
              [
                '1185297723998339/2814749767106560',
                '3495369454932459/14073748835532800',
              ],
              [
                '295076485302059/703687441776640',
                '212696401224663/879609302220800',
              ],
              [
                '6010887132539781/14073748835532800',
                '3336775897742049/14073748835532800',
              ],
              [
                '3055410872194171/7036874417766400',
                '6668142198275441/28147497671065600',
              ],
              [
                '3111545751155507/7036874417766400',
                '6674548227896771/28147497671065600',
              ],
              [
                '800696837299241/1759218604441600',
                '3297847001365873/14073748835532800',
              ],
              [
                '81693078288597/175921860444160',
                '6408087082463397/28147497671065600',
              ],
              [
                '6616862350345503/14073748835532800',
                '612789028802003/2814749767106560',
              ],
              [
                '266288961912465/562949953421312',
                '2784672626528747/14073748835532800',
              ],
              [
                '131604724872695/281474976710656',
                '581425871936553/3518437208883200',
              ],
              [
                '6495035087598387/14073748835532800',
                '1661828262499713/11258999068426240',
              ],
              ['792978781068329/1759218604441600', '799/6400'],
              [
                '594958935929127/1407374883553280',
                '8809463083601757/112589990684262400',
              ],
              ['163/400', '3281998228446249/56294995342131200'],
              ['2493/6400', '8702502592451707/225179981368524800'],
              [
                '2574341549693337/7036874417766400',
                '4667470840374231/225179981368524800',
              ],
              ['9011/25600', '3780648741875221/225179981368524800'],
              [
                '607985949695017/1759218604441600',
                '3895613677675479/225179981368524800',
              ],
              [
                '1186880969202729/3518437208883200',
                '4556629073178133/225179981368524800',
              ],
              [
                '2293917121983283/7036874417766400',
                '716719953100669/22517998136852480',
              ],
              [
                '564414580218921/1759218604441600',
                '2807875070653891/56294995342131200',
              ],
              [
                '1129429253268439/3518437208883200',
                '4108086053405983/56294995342131200',
              ],
              [
                '115874575513813/351843720888320',
                '401105964981289/3518437208883200',
              ],
              [
                '2469589702525583/7036874417766400',
                '2437886659128197/14073748835532800',
              ],
              [
                '5127066700784599/14073748835532800',
                '226981421219473/1125899906842624',
              ],
              [
                '540307160714707/1407374883553280',
                '1341595500909953/5629499534213120',
              ],
              [
                '6035037905443881/14073748835532800',
                '4399041569127137/14073748835532800',
              ],
              [
                '1737459269327913/3518437208883200',
                '357503456992297/879609302220800',
              ],
              [
                '1471269703266599/2814749767106560',
                '6222004360189051/14073748835532800',
              ],
              [
                '7248376474485391/14073748835532800',
                '388358502046761/879609302220800',
              ],
              ['197/400', '89/200'],
              ['3440327902845993/7036874417766400', '89/200'],
              [
                '679718638046937/1407374883553280',
                '1564711561514189/3518437208883200',
              ],
              [
                '6631435002582139/14073748835532800',
                '775433667865477/1759218604441600',
              ],
            ],
            holes: [],
          },
        ],
        plane: [0, 0, 1, 0],
        exactPlane: ['0', '0', '1', '0'],
        matrix: [
          1,
          0,
          0,
          0,
          0,
          1,
          0,
          0,
          0,
          0,
          1,
          0,
          0,
          0,
          0,
          1,
          '1',
          '0',
          '0',
          '0',
          '0',
          '1',
          '0',
          '0',
          '0',
          '0',
          '1',
          '0',
          '1',
        ],
        tags: [],
      },
    ],
  });
});
