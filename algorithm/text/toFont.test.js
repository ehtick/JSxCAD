import { boot, read } from '@jsxcad/sys';

import { prepareForSerialization } from '@jsxcad/geometry';
import test from 'ava';
import { toFont } from './toFont.js';

test('Render a letter', async (t) => {
  await boot();
  const bytes = await read('GreatVibes-Regular.ttf', {
    doSerialize: false,
    sources: ['GreatVibes-Regular.ttf'],
  });
  const font = toFont({}, bytes);
  const letterA = font({}, 'ab');
  t.deepEqual(JSON.parse(JSON.stringify(prepareForSerialization(letterA))), {
    type: 'group',
    tags: [],
    content: [
      {
        type: 'graph',
        tags: [],
        graph: {
          isClosed: false,
          isEmpty: false,
          isLazy: true,
          provenance: 'algorithm/cgal/fromSurfaceMeshToLazyGraph',
          serializedSurfaceMesh:
            '82\n' +
            '4289428132341125/140737488355328 8109823251990215/562949953421312 0\n' +
            '8471006312605795/281474976710656 8213788849388063/562949953421312 0\n' +
            '4292490580087737/140737488355328 1933909011862651/140737488355328 0\n' +
            '520017102989217/17592186044416 8009544976787277/562949953421312 0\n' +
            '8247216817622221/281474976710656 1944992089070633/140737488355328 0\n' +
            '8531506544099983/281474976710656 53/4 0\n' +
            '7779309704837029/281474976710656 2985393971737395/281474976710656 0\n' +
            '7967940160479675/281474976710656 2633595286845349/281474976710656 0\n' +
            '1680775046869549/70368744177664 2631616517759073/562949953421312 0\n' +
            '3076833932671619/140737488355328 7684852332152467/9007199254740992 0\n' +
            '5799879152365847/281474976710656 8138499922617497/4503599627370496 0\n' +
            '5699941461884729/281474976710656 6188306175977251/288230376151711744 0\n' +
            '6155421454448145/281474976710656 5686312443512399/2251799813685248 0\n' +
            '5635129033747333/281474976710656 3895613677675479/2251799813685248 0\n' +
            '5471873547255153/281474976710656 -1261007895663739/9007199254740992 0\n' +
            '5543759441557287/281474976710656 8082294999267913/4503599627370496 0\n' +
            '5211058833835059/281474976710656 -3400758150620009/36028797018963968 0\n' +
            '1110446930621209/140737488355328 4832700170140595/2251799813685248 0\n' +
            '223134713819001/35184372088832 1109230958721819/562949953421312 0\n' +
            '898918485623151/140737488355328 -1556804319189433/36028797018963968 0\n' +
            '5432467050515661/281474976710656 6811694436397875/1125899906842624 0\n' +
            '4458563631096791/281474976710656 643170321783849/70368744177664 0\n' +
            '1075016971615197/70368744177664 7391026233463747/1125899906842624 0\n' +
            '5571104735544727/281474976710656 8812238426872123/1125899906842624 0\n' +
            '6031248768472239/281474976710656 1666314973628481/140737488355328 0\n' +
            '1170507357464287/70368744177664 7066074631850363/562949953421312 0\n' +
            '5399129154274051/281474976710656 4843700212230447/281474976710656 0\n' +
            '1719702332461191/70368744177664 4894058900313751/281474976710656 0\n' +
            '2930676643639727/140737488355328 5404831837302209/281474976710656 0\n' +
            '6237893622624367/281474976710656 86933502576621/4398046511104 0\n' +
            '7099589857327301/281474976710656 5476622030112261/281474976710656 0\n' +
            '808185026880471/35184372088832 5573204538870989/281474976710656 0\n' +
            '7315534644709949/281474976710656 5491576795624899/281474976710656 0\n' +
            '8353034520366825/562949953421312 8531506544099983/1125899906842624 0\n' +
            '947284330871343/70368744177664 262717132418937/35184372088832 0\n' +
            '3281998228446249/281474976710656 5753348523965809/1125899906842624 0\n' +
            '3429817627215617/281474976710656 2263762500195451/562949953421312 0\n' +
            '5840937907218631/562949953421312 4238686638289495/1125899906842624 0\n' +
            '3000523251735593/281474976710656 2679641778285445/1125899906842624 0\n' +
            '5147400453102177/562949953421312 1272897398679997/1125899906842624 0\n' +
            '4651801832108191/1125899906842624 6370251600923019/18014398509481984 0\n' +
            '2855090760768731/1125899906842624 1174105311354091/562949953421312 0\n' +
            '6277533743594529/1125899906842624 5393646021727727/2251799813685248 0\n' +
            '2791421121036781/562949953421312 2623532556427943/562949953421312 0\n' +
            '7920480664656491/4503599627370496 2768238841954891/562949953421312 0\n' +
            '5674535530486825/1125899906842624 6237485483908137/1125899906842624 0\n' +
            '8823227209962907/4503599627370496 151529414884275/17592186044416 0\n' +
            '788438149889335/140737488355328 8659757802488427/1125899906842624 0\n' +
            '927764041236459/281474976710656 7283677306845837/562949953421312 0\n' +
            '4497970127836283/562949953421312 1804254600715305/140737488355328 0\n' +
            '6674796266724881/1125899906842624 4969952998284245/281474976710656 0\n' +
            '8759501275235615/1125899906842624 5654832282117079/281474976710656 0\n' +
            '5699254662941555/562949953421312 8986617804443909/562949953421312 0\n' +
            '4860746336820045/562949953421312 739514632343535/35184372088832 0\n' +
            '7767532791811455/562949953421312 5680483096744721/281474976710656 0\n' +
            '1793240484876617/140737488355328 422570114208267/17592186044416 0\n' +
            '5952632807476953/562949953421312 1595624644289925/70368744177664 0\n' +
            '4597713600583471/281474976710656 6283917596066327/281474976710656 0\n' +
            '8468039566351265/562949953421312 1759146124635097/70368744177664 0\n' +
            '2472757670403113/140737488355328 1626221677945815/70368744177664 0\n' +
            '4892080131227475/281474976710656 7193481465308675/281474976710656 0\n' +
            '5225380280650097/281474976710656 207197336754853/8796093022208 0\n' +
            '720120302760729/35184372088832 6720859646663579/281474976710656 0\n' +
            '1383453028970083/70368744177664 3608203801080879/140737488355328 0\n' +
            '3066184326927771/140737488355328 3544980299187015/140737488355328 0\n' +
            '6964366463765735/281474976710656 1519559550271079/70368744177664 0\n' +
            '1758906870904893/70368744177664 6251201759523247/281474976710656 0\n' +
            '1640247576035307/70368744177664 6252400842924035/281474976710656 0\n' +
            '6890507429876859/281474976710656 3293257227514675/140737488355328 0\n' +
            '6660894217625141/281474976710656 6798732513720349/281474976710656 0\n' +
            '1696987301840641/70368744177664 5994068738798529/281474976710656 0\n' +
            '6668142198275441/281474976710656 5998231753704079/281474976710656 0\n' +
            '6976658475998689/281474976710656 6471531927043047/281474976710656 0\n' +
            '3111394837687037/140737488355328 6595679280271049/281474976710656 0\n' +
            '4137152984690427/562949953421312 1638426432935989/140737488355328 0\n' +
            '5735244053463779/1125899906842624 3696813531124277/1125899906842624 0\n' +
            '5411685752985113/281474976710656 2611006919964319/1125899906842624 0\n' +
            '2348276769327709/140737488355328 6638035634766469/9007199254740992 0\n' +
            '5358053510922665/281474976710656 4650495788216253/1125899906842624 0\n' +
            '4401849238039361/281474976710656 2451624529151677/1125899906842624 0\n' +
            '4289245173606263/281474976710656 8123345309871395/2251799813685248 0\n' +
            '6814013790205971/281474976710656 1743658667729035/562949953421312 0\n' +
            '\n' +
            '80\n' +
            '3 2 0 1\n' +
            '3 4 2 3\n' +
            '3 3 2 1\n' +
            '3 5 2 4\n' +
            '3 5 4 6\n' +
            '3 5 6 7\n' +
            '3 6 8 7\n' +
            '3 11 9 10\n' +
            '3 9 12 10\n' +
            '3 11 13 14\n' +
            '3 14 15 16\n' +
            '3 19 17 18\n' +
            '3 22 20 21\n' +
            '3 25 23 24\n' +
            '3 28 26 27\n' +
            '3 28 27 29\n' +
            '3 27 30 31\n' +
            '3 32 30 27\n' +
            '3 27 31 29\n' +
            '3 26 24 27\n' +
            '3 25 24 26\n' +
            '3 34 33 21\n' +
            '3 20 23 21\n' +
            '3 36 34 35\n' +
            '3 38 36 37\n' +
            '3 39 17 19\n' +
            '3 19 18 40\n' +
            '3 42 41 40\n' +
            '3 41 43 44\n' +
            '3 44 45 46\n' +
            '3 46 47 48\n' +
            '3 50 48 49\n' +
            '3 53 51 52\n' +
            '3 53 52 54\n' +
            '3 56 54 55\n' +
            '3 55 57 58\n' +
            '3 58 59 60\n' +
            '3 59 61 60\n' +
            '3 61 62 63\n' +
            '3 62 64 63\n' +
            '3 67 65 66\n' +
            '3 69 67 68\n' +
            '3 71 70 67\n' +
            '3 67 70 65\n' +
            '3 67 66 72\n' +
            '3 67 72 68\n' +
            '3 73 67 69\n' +
            '3 73 69 64\n' +
            '3 73 64 62\n' +
            '3 61 63 60\n' +
            '3 57 59 58\n' +
            '3 54 57 55\n' +
            '3 53 54 56\n' +
            '3 51 50 52\n' +
            '3 50 49 52\n' +
            '3 48 74 49\n' +
            '3 47 74 48\n' +
            '3 45 47 46\n' +
            '3 43 45 44\n' +
            '3 75 43 41\n' +
            '3 75 41 42\n' +
            '3 42 40 18\n' +
            '3 16 76 77\n' +
            '3 15 76 16\n' +
            '3 79 76 78\n' +
            '3 39 38 17\n' +
            '3 38 37 17\n' +
            '3 36 35 37\n' +
            '3 34 36 33\n' +
            '3 34 21 25\n' +
            '3 21 23 25\n' +
            '3 22 78 20\n' +
            '3 79 78 80\n' +
            '3 80 78 22\n' +
            '3 77 76 79\n' +
            '3 13 15 14\n' +
            '3 10 13 11\n' +
            '3 81 12 9\n' +
            '3 8 12 81\n' +
            '3 8 81 7\n' +
            '',
          hash: 'a8utZMo4D1OQ+/Pb1P0sl4MJgNiXfUimEIW8pPBh4n4=',
        },
        matrix: [0.01, 0, 0, 0, 0, 0.01, 0, 0, 0, 0, 0.01, 0, 0, 0, 0, 1],
        cache: {
          boundingBox: [
            [0.017586999999999985, -0.001400000000000001, -2e-323],
            [0.3049998000000002, 0.2563783000000002, 1.5e-323],
          ],
        },
      },
      {
        type: 'graph',
        tags: [],
        graph: {
          isClosed: false,
          isEmpty: false,
          isLazy: true,
          provenance: 'algorithm/cgal/fromSurfaceMeshToLazyGraph',
          serializedSurfaceMesh:
            '73\n' +
            '6931436706240355/140737488355328 3118647040461987/140737488355328 0\n' +
            '3308430839821705/70368744177664 1531972596744019/70368744177664 0\n' +
            '3328611891964417/70368744177664 2784672758470143/140737488355328 0\n' +
            '1073334454941909/35184372088832 8971401267202931/562949953421312 0\n' +
            '3589886816971433/140737488355328 3840461470738793/562949953421312 0\n' +
            '8245502635014053/281474976710656 3144120525854301/281474976710656 0\n' +
            '4515316023276077/140737488355328 1403938074087643/281474976710656 0\n' +
            '8047420249653463/281474976710656 7398468431847977/2251799813685248 0\n' +
            '4587833828900927/140737488355328 3583604295491251/1125899906842624 0\n' +
            '893127841664771/35184372088832 5076930377932897/1125899906842624 0\n' +
            '825777212924887/35184372088832 2105432825795707/562949953421312 0\n' +
            '6769473189891277/281474976710656 6327557476455547/2251799813685248 0\n' +
            '3278854152956391/140737488355328 7325037239923701/2251799813685248 0\n' +
            '6658071023608733/281474976710656 5967629794236097/2251799813685248 0\n' +
            '4458563631096791/140737488355328 8793278272440893/562949953421312 0\n' +
            '4939179339080469/140737488355328 4875774285826627/281474976710656 0\n' +
            '4837634426482333/140737488355328 -1936908127739503/18014398509481984 0\n' +
            '4747524434813067/140737488355328 17799334035089/8796093022208 0\n' +
            '567291353093353/17592186044416 1246956664826343/9007199254740992 0\n' +
            '1238462453716657/35184372088832 3780659297186847/2251799813685248 0\n' +
            '607985949695017/17592186044416 3895613677675479/2251799813685248 0\n' +
            '8265639354847933/281474976710656 2139243599998191/1125899906842624 0\n' +
            '5203238051607153/140737488355328 2818532790793551/18014398509481984 0\n' +
            '7950190348448301/281474976710656 5540463369580005/1125899906842624 0\n' +
            '7971047644222561/281474976710656 474355704501633/70368744177664 0\n' +
            '87003409525915/2199023255552 7729708184441077/9007199254740992 0\n' +
            '5864327070408403/140737488355328 1074260507615287/562949953421312 0\n' +
            '2741082839889289/70368744177664 8702508221951241/2251799813685248 0\n' +
            '163/4 3281998228446249/562949953421312 0\n' +
            '6260003482044989/140737488355328 4711981182128929/1125899906842624 0\n' +
            '2705678213631181/70368744177664 1/2 0\n' +
            '5949590062978711/140737488355328 4404734356550645/562949953421312 0\n' +
            '6684591595914411/140737488355328 574137176370677/70368744177664 0\n' +
            '6974070313587835/140737488355328 892699296012729/70368744177664 0\n' +
            '6343830952234073/140737488355328 7028075509994425/562949953421312 0\n' +
            '6495035087598387/140737488355328 8309141312498565/562949953421312 0\n' +
            '7062207165670359/140737488355328 4216495151125627/281474976710656 0\n' +
            '6580236155673819/140737488355328 1162851941785199/70368744177664 0\n' +
            '185202750133287/4398046511104 1747684463583439/70368744177664 0\n' +
            '3005443434328495/70368744177664 6673552147327819/281474976710656 0\n' +
            '3051062083803991/70368744177664 3546959068273291/140737488355328 0\n' +
            '3125779616371835/70368744177664 7073466164738785/281474976710656 0\n' +
            '3111545426799577/70368744177664 6674548568745375/281474976710656 0\n' +
            '3055410872194171/70368744177664 6668142198275441/281474976710656 0\n' +
            '731818050949103/17592186044416 5205726290401275/140737488355328 0\n' +
            '6949836725467931/140737488355328 715006957965059/17592186044416 0\n' +
            '775111717116969/17592186044416 1441503724479447/35184372088832 0\n' +
            '6378355265502519/140737488355328 5994647169875669/140737488355328 0\n' +
            '6035037421658765/140737488355328 274940095321667/8796093022208 0\n' +
            '2950764809040125/70368744177664 850785560918187/35184372088832 0\n' +
            '1596027857194063/35184372088832 3509480675124267/140737488355328 0\n' +
            '6405575303125323/140737488355328 6595693354019885/281474976710656 0\n' +
            '3306300074248005/70368744177664 854774061338177/35184372088832 0\n' +
            '5127066700784599/140737488355328 5674535530486825/281474976710656 0\n' +
            '7356348516332995/140737488355328 6222004360189051/140737488355328 0\n' +
            '3624188061320835/70368744177664 6213736032748175/140737488355328 0\n' +
            '25529087695331/549755813888 3204043733646233/140737488355328 0\n' +
            '1764760143045591/35184372088832 5630825281353427/281474976710656 0\n' +
            '7095720983772413/140737488355328 4701879045214783/281474976710656 0\n' +
            '5083011644804731/140737488355328 7556767144000283/281474976710656 0\n' +
            '849281253089529/17592186044416 6573096542889553/281474976710656 0\n' +
            '4634983702249729/140737488355328 6417697022997367/562949953421312 0\n' +
            '8629670942227825/281474976710656 1893337208719577/140737488355328 0\n' +
            '2044036096500695/70368744177664 5329818756008819/562949953421312 0\n' +
            '8024851586020803/281474976710656 8669429282688205/1125899906842624 0\n' +
            '4517717004827419/140737488355328 4108087878595285/562949953421312 0\n' +
            '2574341285810547/70368744177664 4667463099812371/2251799813685248 0\n' +
            '4303876242895683/140737488355328 7469670341956705/9007199254740992 0\n' +
            '5403071211322883/140737488355328 6707976536979533/281474976710656 0\n' +
            '197/4 89/2 0\n' +
            '3440327902845993/70368744177664 89/2 0\n' +
            '1699296452180831/35184372088832 6258846619890709/140737488355328 0\n' +
            '1657858761640651/35184372088832 3101734616486327/70368744177664 0\n' +
            '\n' +
            '71\n' +
            '3 2 0 1\n' +
            '3 5 3 4\n' +
            '3 8 6 7\n' +
            '3 11 9 10\n' +
            '3 9 4 10\n' +
            '3 11 12 13\n' +
            '3 10 12 11\n' +
            '3 5 4 9\n' +
            '3 14 3 5\n' +
            '3 15 3 14\n' +
            '3 18 16 17\n' +
            '3 16 19 20\n' +
            '3 7 21 8\n' +
            '3 16 22 19\n' +
            '3 24 23 6\n' +
            '3 27 25 26\n' +
            '3 27 26 28\n' +
            '3 26 29 28\n' +
            '3 30 25 27\n' +
            '3 32 31 29\n' +
            '3 34 32 33\n' +
            '3 37 35 36\n' +
            '3 40 38 39\n' +
            '3 42 41 40\n' +
            '3 43 40 39\n' +
            '3 42 40 43\n' +
            '3 46 44 45\n' +
            '3 46 45 47\n' +
            '3 45 44 48\n' +
            '3 38 49 39\n' +
            '3 52 50 51\n' +
            '3 3 15 53\n' +
            '3 45 54 55\n' +
            '3 52 51 56\n' +
            '3 58 57 2\n' +
            '3 59 48 44\n' +
            '3 58 2 37\n' +
            '3 3 53 59\n' +
            '3 42 50 41\n' +
            '3 36 58 37\n' +
            '3 51 50 42\n' +
            '3 52 56 60\n' +
            '3 1 0 60\n' +
            '3 56 1 60\n' +
            '3 2 57 0\n' +
            '3 61 15 14\n' +
            '3 36 35 33\n' +
            '3 14 62 61\n' +
            '3 35 34 33\n' +
            '3 34 31 32\n' +
            '3 65 63 64\n' +
            '3 31 28 29\n' +
            '3 24 6 65\n' +
            '3 66 22 30\n' +
            '3 27 66 30\n' +
            '3 19 22 66\n' +
            '3 64 24 65\n' +
            '3 16 20 17\n' +
            '3 18 8 67\n' +
            '3 18 17 8\n' +
            '3 8 21 67\n' +
            '3 6 23 7\n' +
            '3 61 63 65\n' +
            '3 61 62 63\n' +
            '3 53 68 59\n' +
            '3 59 68 48\n' +
            '3 45 55 69\n' +
            '3 45 69 70\n' +
            '3 45 70 71\n' +
            '3 45 71 72\n' +
            '3 45 72 47\n' +
            '',
          hash: 'A2QjFsxN2JtHODWsaKAnJMbyAYgSWjQWeAp3vMkws4g=',
        },
        matrix: [0.01, 0, 0, 0, 0, 0.01, 0, 0, 0, 0, 0.01, 0, 0, 0, 0, 1],
        cache: {
          boundingBox: [
            [0.2329765999999999, -0.001075200000000001, -2e-323],
            [0.5227000000000005, 0.44500000000000023, 1.5e-323],
          ],
        },
      },
    ],
  });
});
