import { boot, read } from '@jsxcad/sys';

import { prepareForSerialization } from '@jsxcad/geometry';
import test from 'ava';
import { toFont } from './toFont.js';

test('Render a letter', async (t) => {
  await boot();
  const bytes = await read('GreatVibes-Regular.ttf', {
    doSerialize: false,
    sources: ['GreatVibes-Regular.ttf'],
  });
  const font = toFont({}, bytes);
  const letterA = font({}, 'ab');
  t.deepEqual(JSON.parse(JSON.stringify(prepareForSerialization(letterA))), {
    type: 'group',
    tags: [],
    content: [
      {
        type: 'graph',
        tags: [],
        graph: {
          isClosed: false,
          isEmpty: false,
          isLazy: true,
          provenance: 'algorithm/cgal/fromSurfaceMeshToLazyGraph',
          serializedSurfaceMesh:
            '82\n' +
            '701/23 461/32 0\n' +
            '632/21 321/22 0\n' +
            '61/2 371/27 0\n' +
            '739/25 313/22 0\n' +
            '293/10 539/39 0\n' +
            '879/29 53/4 0\n' +
            '1299/47 297/28 0\n' +
            '368/13 131/14 0\n' +
            '621/26 173/37 0\n' +
            '634/29 29/34 0\n' +
            '680/33 47/26 0\n' +
            '81/4 1/45 0\n' +
            '831/38 101/40 0\n' +
            '961/48 45/26 0\n' +
            '486/25 -6/43 0\n' +
            '453/23 61/34 0\n' +
            '648/35 -2/21 0\n' +
            '434/55 73/34 0\n' +
            '222/35 65/33 0\n' +
            '198/31 -1/23 0\n' +
            '193/10 121/20 0\n' +
            '396/25 393/43 0\n' +
            '275/18 151/23 0\n' +
            '475/24 180/23 0\n' +
            '1457/68 296/25 0\n' +
            '499/30 364/29 0\n' +
            '211/11 413/24 0\n' +
            '391/16 539/31 0\n' +
            '354/17 1421/74 0\n' +
            '687/31 593/30 0\n' +
            '227/9 681/35 0\n' +
            '758/33 99/5 0\n' +
            '2365/91 917/47 0\n' +
            '460/31 197/26 0\n' +
            '175/13 112/15 0\n' +
            '513/44 281/55 0\n' +
            '329/27 181/45 0\n' +
            '83/8 64/17 0\n' +
            '469/44 50/21 0\n' +
            '64/7 26/23 0\n' +
            '157/38 6/17 0\n' +
            '71/28 73/35 0\n' +
            '184/33 91/38 0\n' +
            '119/24 219/47 0\n' +
            '51/29 59/12 0\n' +
            '126/25 205/37 0\n' +
            '47/24 267/31 0\n' +
            '353/63 100/13 0\n' +
            '89/27 207/16 0\n' +
            '727/91 500/39 0\n' +
            '83/14 565/32 0\n' +
            '319/41 221/11 0\n' +
            '658/65 431/27 0\n' +
            '354/41 1093/52 0\n' +
            '952/69 222/11 0\n' +
            '344/27 1129/47 0\n' +
            '497/47 839/37 0\n' +
            '2728/167 826/37 0\n' +
            '361/24 12324/493 0\n' +
            '1142/65 1271/55 0\n' +
            '365/21 230/9 0\n' +
            '427/23 212/9 0\n' +
            '307/15 979/41 0\n' +
            '865/44 1205/47 0\n' +
            '305/14 932/37 0\n' +
            '767/31 691/32 0\n' +
            '4624/185 533/24 0\n' +
            '979/42 733/33 0\n' +
            '612/25 117/5 0\n' +
            '2319/98 314/13 0\n' +
            '627/26 937/44 0\n' +
            '687/29 618/29 0\n' +
            '347/14 2437/106 0\n' +
            '619/28 703/30 0\n' +
            '147/20 454/39 0\n' +
            '163/32 151/46 0\n' +
            '596/31 51/22 0\n' +
            '584/35 14/19 0\n' +
            '533/28 95/23 0\n' +
            '563/36 98/45 0\n' +
            '320/21 101/28 0\n' +
            '581/24 96/31 0\n' +
            '\n' +
            '80\n' +
            '3 2 0 1\n' +
            '3 4 2 3\n' +
            '3 3 2 1\n' +
            '3 5 2 4\n' +
            '3 5 4 6\n' +
            '3 5 6 7\n' +
            '3 6 8 7\n' +
            '3 11 9 10\n' +
            '3 9 12 10\n' +
            '3 11 13 14\n' +
            '3 14 15 16\n' +
            '3 19 17 18\n' +
            '3 22 20 21\n' +
            '3 25 23 24\n' +
            '3 28 26 27\n' +
            '3 28 27 29\n' +
            '3 27 30 31\n' +
            '3 32 30 27\n' +
            '3 27 31 29\n' +
            '3 26 24 27\n' +
            '3 25 24 26\n' +
            '3 34 33 21\n' +
            '3 20 23 21\n' +
            '3 36 34 35\n' +
            '3 38 36 37\n' +
            '3 39 17 19\n' +
            '3 19 18 40\n' +
            '3 42 41 40\n' +
            '3 41 43 44\n' +
            '3 44 45 46\n' +
            '3 46 47 48\n' +
            '3 50 48 49\n' +
            '3 53 51 52\n' +
            '3 53 52 54\n' +
            '3 56 54 55\n' +
            '3 55 57 58\n' +
            '3 58 59 60\n' +
            '3 59 61 60\n' +
            '3 61 62 63\n' +
            '3 62 64 63\n' +
            '3 67 65 66\n' +
            '3 69 67 68\n' +
            '3 71 70 67\n' +
            '3 67 70 65\n' +
            '3 67 66 72\n' +
            '3 67 72 68\n' +
            '3 73 67 69\n' +
            '3 73 69 64\n' +
            '3 73 64 62\n' +
            '3 61 63 60\n' +
            '3 57 59 58\n' +
            '3 54 57 55\n' +
            '3 53 54 56\n' +
            '3 51 50 52\n' +
            '3 50 49 52\n' +
            '3 48 74 49\n' +
            '3 47 74 48\n' +
            '3 45 47 46\n' +
            '3 43 45 44\n' +
            '3 75 43 41\n' +
            '3 75 41 42\n' +
            '3 42 40 18\n' +
            '3 16 76 77\n' +
            '3 15 76 16\n' +
            '3 79 76 78\n' +
            '3 39 38 17\n' +
            '3 38 37 17\n' +
            '3 36 35 37\n' +
            '3 34 36 33\n' +
            '3 34 21 25\n' +
            '3 21 23 25\n' +
            '3 22 78 20\n' +
            '3 79 78 80\n' +
            '3 80 78 22\n' +
            '3 77 76 79\n' +
            '3 13 15 14\n' +
            '3 10 13 11\n' +
            '3 81 12 9\n' +
            '3 8 12 81\n' +
            '3 8 81 7\n',
          hash: 'XEVn55wXnzEQwF5CJEyZHqwIBqsE8d8lBn7Y3hKAmSA=',
        },
        matrix: [
          0.009999999999999998,
          0,
          0,
          0,
          0,
          0.009999999999999998,
          0,
          0,
          0,
          0,
          0.009999999999999998,
          0,
          0,
          0,
          0,
          1,
          '1/100',
          '0',
          '0',
          '0',
          '0',
          '1/100',
          '0',
          '0',
          '0',
          '0',
          '1/100',
          '0',
          '1',
        ],
        cache: {
          boundingBox: [
            [0.017586206896551708, -0.0013953488372093034, -2e-323],
            [0.3050000000000002, 0.2563829787234045, 1.5e-323],
          ],
        },
      },
      {
        type: 'graph',
        tags: [],
        graph: {
          isClosed: false,
          isEmpty: false,
          isLazy: true,
          provenance: 'algorithm/cgal/fromSurfaceMeshToLazyGraph',
          serializedSurfaceMesh:
            '73\n' +
            '197/4 554/25 0\n' +
            '2868/61 762/35 0\n' +
            '1561/33 277/14 0\n' +
            '2227/73 494/31 0\n' +
            '1505/59 191/28 0\n' +
            '498/17 458/41 0\n' +
            '385/12 379/76 0\n' +
            '629/22 23/7 0\n' +
            '2673/82 156/49 0\n' +
            '330/13 221/49 0\n' +
            '399/17 86/23 0\n' +
            '481/20 59/21 0\n' +
            '862/37 205/63 0\n' +
            '615/26 53/20 0\n' +
            '792/25 328/21 0\n' +
            '737/21 485/28 0\n' +
            '1753/51 -3/28 0\n' +
            '506/15 83/41 0\n' +
            '1967/61 4/29 0\n' +
            '176/5 47/28 0\n' +
            '864/25 45/26 0\n' +
            '1204/41 19/10 0\n' +
            '1257/34 5/32 0\n' +
            '1158/41 123/25 0\n' +
            '623/22 182/27 0\n' +
            '910/23 61/71 0\n' +
            '4917/118 21/11 0\n' +
            '818/21 143/37 0\n' +
            '163/4 239/41 0\n' +
            '1112/25 113/27 0\n' +
            '769/20 1/2 0\n' +
            '1691/40 133/17 0\n' +
            '5842/123 359/44 0\n' +
            '2329/47 444/35 0\n' +
            '1803/40 387/31 0\n' +
            '923/20 369/25 0\n' +
            '1957/39 719/48 0\n' +
            '1917/41 661/40 0\n' +
            '379/9 1217/49 0\n' +
            '1324/31 569/24 0\n' +
            '1691/39 1487/59 0\n' +
            '1377/31 578/23 0\n' +
            '1017/23 1399/59 0\n' +
            '1346/31 687/29 0\n' +
            '208/5 3070/83 0\n' +
            '1037/21 569/14 0\n' +
            '1454/33 1352/33 0\n' +
            '1133/25 1363/32 0\n' +
            '729/17 969/31 0\n' +
            '629/15 1209/50 0\n' +
            '1633/36 773/31 0\n' +
            '1502/33 703/30 0\n' +
            '3007/64 413/17 0\n' +
            '2368/65 504/25 0\n' +
            '1359/26 840/19 0\n' +
            '6850/133 1457/33 0\n' +
            '743/16 683/30 0\n' +
            '953/19 3521/176 0\n' +
            '2168/43 451/27 0\n' +
            '614/17 349/13 0\n' +
            '1400/29 397/17 0\n' +
            '494/15 57/5 0\n' +
            '1165/38 565/42 0\n' +
            '610/21 142/15 0\n' +
            '1340/47 77/10 0\n' +
            '321/10 270/37 0\n' +
            '439/12 85/41 0\n' +
            '948/31 29/35 0\n' +
            '883/23 1549/65 0\n' +
            '197/4 89/2 0\n' +
            '2689/55 89/2 0\n' +
            '1304/27 1601/36 0\n' +
            '1178/25 1675/38 0\n' +
            '\n' +
            '71\n' +
            '3 2 0 1\n' +
            '3 5 3 4\n' +
            '3 8 6 7\n' +
            '3 11 9 10\n' +
            '3 9 4 10\n' +
            '3 11 12 13\n' +
            '3 10 12 11\n' +
            '3 5 4 9\n' +
            '3 14 3 5\n' +
            '3 15 3 14\n' +
            '3 18 16 17\n' +
            '3 16 19 20\n' +
            '3 7 21 8\n' +
            '3 16 22 19\n' +
            '3 24 23 6\n' +
            '3 27 25 26\n' +
            '3 27 26 28\n' +
            '3 26 29 28\n' +
            '3 30 25 27\n' +
            '3 32 31 29\n' +
            '3 34 32 33\n' +
            '3 37 35 36\n' +
            '3 40 38 39\n' +
            '3 42 41 40\n' +
            '3 43 40 39\n' +
            '3 42 40 43\n' +
            '3 46 44 45\n' +
            '3 46 45 47\n' +
            '3 45 44 48\n' +
            '3 38 49 39\n' +
            '3 52 50 51\n' +
            '3 3 15 53\n' +
            '3 45 54 55\n' +
            '3 52 51 56\n' +
            '3 58 57 2\n' +
            '3 59 48 44\n' +
            '3 58 2 37\n' +
            '3 3 53 59\n' +
            '3 42 50 41\n' +
            '3 36 58 37\n' +
            '3 51 50 42\n' +
            '3 52 56 60\n' +
            '3 1 0 60\n' +
            '3 56 1 60\n' +
            '3 2 57 0\n' +
            '3 61 15 14\n' +
            '3 36 35 33\n' +
            '3 14 62 61\n' +
            '3 35 34 33\n' +
            '3 34 31 32\n' +
            '3 65 63 64\n' +
            '3 31 28 29\n' +
            '3 24 6 65\n' +
            '3 66 22 30\n' +
            '3 27 66 30\n' +
            '3 19 22 66\n' +
            '3 64 24 65\n' +
            '3 16 20 17\n' +
            '3 18 8 67\n' +
            '3 18 17 8\n' +
            '3 8 21 67\n' +
            '3 6 23 7\n' +
            '3 61 63 65\n' +
            '3 61 62 63\n' +
            '3 53 68 59\n' +
            '3 59 68 48\n' +
            '3 45 55 69\n' +
            '3 45 69 70\n' +
            '3 45 70 71\n' +
            '3 45 71 72\n' +
            '3 45 72 47\n',
          hash: '9/bl40bsLpKZ9dWB2Nz3mRm7bBLsQArOXhR7oHiE7UI=',
        },
        matrix: [
          0.009999999999999998,
          0,
          0,
          0,
          0,
          0.009999999999999998,
          0,
          0,
          0,
          0,
          0.009999999999999998,
          0,
          0,
          0,
          0,
          1,
          '1/100',
          '0',
          '0',
          '0',
          '0',
          '1/100',
          '0',
          '0',
          '0',
          '0',
          '1/100',
          '0',
          '1',
        ],
        cache: {
          boundingBox: [
            [0.2329729729729728, -0.0010714285714285723, -2e-323],
            [0.5226923076923082, 0.44500000000000023, 1.5e-323],
          ],
        },
      },
    ],
  });
});
