import { boot, read } from '@jsxcad/sys';

import { prepareForSerialization } from '@jsxcad/geometry';
import test from 'ava';
import { toFont } from './toFont.js';

test('Render a letter', async (t) => {
  await boot();
  const bytes = await read('GreatVibes-Regular.ttf', {
    doSerialize: false,
    sources: ['GreatVibes-Regular.ttf'],
  });
  const font = toFont({}, bytes);
  const letterA = font({}, 'ab');
  t.deepEqual(JSON.parse(JSON.stringify(prepareForSerialization(letterA))), {
    type: 'group',
    tags: [],
    content: [
      {
        type: 'graph',
        tags: [],
        graph: {
          isClosed: false,
          isEmpty: false,
          isLazy: true,
          provenance: 'algorithm/cgal/fromSurfaceMeshToLazyGraph',
          isOutline: false,
          serializedSurfaceMesh:
            '82\n' +
            '5482643024624951/18014398509481984 652695598169637/4503599627370496 0\n' +
            '5404319552844595/18014398509481984 5272506880823995/36028797018963968 0\n' +
            '667199944795629/2251799813685248 2573485501354569/18014398509481984 0\n' +
            '5482643024624951/18014398509481984 2484744621997515/18014398509481984 0\n' +
            '5272506880823995/18014398509481984 2484744621997515/18014398509481984 0\n' +
            '1364727159809241/4503599627370496 4803839602528529/36028797018963968 0\n' +
            '2484744621997515/9007199254740992 948126237341157/9007199254740992 0\n' +
            '5091025665723169/18014398509481984 3/32 0\n' +
            '4289142502257615/18014398509481984 857828500451523/18014398509481984 0\n' +
            '7/32 3695261232714253/144115188075855872 0\n' +
            '7454233865992545/36028797018963968 5438308983994561/288230376151711744 0\n' +
            '7/32 5490102402889747/576460752303423488 0\n' +
            '7327890919111315/36028797018963968 0 0\n' +
            '7205759403792793/36028797018963968 2620276146833743/144115188075855872 0\n' +
            '3486657776028771/18014398509481984 -2764799771239441/1152921504606846976 0\n' +
            '7064470003718425/36028797018963968 5438308983994561/288230376151711744 0\n' +
            '866076851417403/4503599627370496 857828500451523/36028797018963968 0\n' +
            '3335999723978145/18014398509481984 0 0\n' +
            '2844378712023471/36028797018963968 3202559735019019/144115188075855872 0\n' +
            '1/16 5882252574524729/288230376151711744 0\n' +
            '1162219258676257/18014398509481984 0 0\n' +
            '866076851417403/4503599627370496 8734253822779143/144115188075855872 0\n' +
            '2844378712023471/18014398509481984 6550690367084357/72057594037927936 0\n' +
            '5482643024624951/36028797018963968 4699408306821387/72057594037927936 0\n' +
            '3548290615504027/18014398509481984 2844378712023471/36028797018963968 0\n' +
            '7720456504063707/36028797018963968 4238682002231055/36028797018963968 0\n' +
            '6004799503160661/36028797018963968 1/8 0\n' +
            '1098438933504999/4503599627370496 1566469435607129/9007199254740992 0\n' +
            '866076851417403/4503599627370496 6211861554993787/36028797018963968 0\n' +
            '2001599834386887/9007199254740992 885954025056491/4503599627370496 0\n' +
            '3752999689475413/18014398509481984 866076851417403/4503599627370496 0\n' +
            '4560607217590375/18014398509481984 875699927544263/4503599627370496 0\n' +
            '8256599316845909/36028797018963968 7104269834725289/36028797018963968 0\n' +
            '4699408306821387/18014398509481984 875699927544263/4503599627370496 0\n' +
            '4348303088495651/18014398509481984 3821236047465875/18014398509481984 0\n' +
            '8406719304424925/36028797018963968 2001599834386887/9007199254740992 0\n' +
            '8533136136070413/36028797018963968 3821236047465875/18014398509481984 0\n' +
            '3242591731706757/18014398509481984 1364727159809241/9007199254740992 0\n' +
            '667199944795629/4503599627370496 5404319552844595/72057594037927936 0\n' +
            '4868756353914049/36028797018963968 667199944795629/9007199254740992 0\n' +
            '8734253822779143/72057594037927936 2882303761517117/72057594037927936 0\n' +
            '8378790004410225/72057594037927936 3695261232714253/72057594037927936 0\n' +
            '7454233865992545/72057594037927936 5542891849071379/144115188075855872 0\n' +
            '7720456504063707/72057594037927936 7030009174431993/288230376151711744 0\n' +
            '6550690367084357/72057594037927936 7030009174431993/576460752303423488 0\n' +
            '6004799503160661/144115188075855872 2608419693680649/576460752303423488 0\n' +
            '948126237341157/36028797018963968 1566469435607129/72057594037927936 0\n' +
            '2001599834386887/36028797018963968 7030009174431993/288230376151711744 0\n' +
            '667199944795629/36028797018963968 7205759403792793/144115188075855872 0\n' +
            '7205759403792793/144115188075855872 4803839602528529/144115188075855872 0\n' +
            '2001599834386887/36028797018963968 5542891849071379/72057594037927936 0\n' +
            '5882252574524729/288230376151711744 1566469435607129/18014398509481984 0\n' +
            '7205759403792793/144115188075855872 2001599834386887/36028797018963968 0\n' +
            '4803839602528529/144115188075855872 1162219258676257/9007199254740992 0\n' +
            '2882303761517117/36028797018963968 1162219258676257/9007199254740992 0\n' +
            '4238682002231055/72057594037927936 3179011501673291/18014398509481984 0\n' +
            '1566469435607129/18014398509481984 948126237341157/4503599627370496 0\n' +
            '7352815718155911/72057594037927936 2882303761517117/18014398509481984 0\n' +
            '2484744621997515/18014398509481984 3651567265435537/18014398509481984 0\n' +
            '5542891849071379/72057594037927936 7205759403792793/36028797018963968 0\n' +
            '288692283805801/2251799813685248 1080863910568919/4503599627370496 0\n' +
            '948126237341157/9007199254740992 8188362958855447/36028797018963968 0\n' +
            '5865153003087157/36028797018963968 8075420021491923/36028797018963968 0\n' +
            '5404319552844595/36028797018963968 1/4 0\n' +
            '3179011501673291/18014398509481984 8314337773607069/36028797018963968 0\n' +
            '1566469435607129/9007199254740992 288692283805801/1125899906842624 0\n' +
            '3335999723978145/18014398509481984 4238682002231055/18014398509481984 0\n' +
            '440569528764505/2251799813685248 289517118902389/1125899906842624 0\n' +
            '3695261232714253/18014398509481984 4289142502257615/18014398509481984 0\n' +
            '7832347178035645/36028797018963968 4555365140328777/18014398509481984 0\n' +
            '1098438933504999/4503599627370496 8406719304424925/36028797018963968 0\n' +
            '8533136136070413/36028797018963968 4348303088495651/18014398509481984 0\n' +
            '2220953240895039/9007199254740992 7790010166262479/36028797018963968 0\n' +
            '1/4 2001599834386887/9007199254740992 0\n' +
            '1111999907992715/4503599627370496 8314337773607069/36028797018963968 0\n' +
            '7938548495703925/36028797018963968 4238682002231055/18014398509481984 0\n' +
            '667199944795629/9007199254740992 8378790004410225/72057594037927936 0\n' +
            '6004799503160661/36028797018963968 4803839602528529/576460752303423488 0\n' +
            '857828500451523/4503599627370496 6004799503160661/144115188075855872 0\n' +
            '5/32 6550690367084357/288230376151711744 0\n' +
            '1364727159809241/9007199254740992 667199944795629/18014398509481984 0\n' +
            '4348303088495651/18014398509481984 1/32 0\n' +
            '\n' +
            '80\n' +
            '3 2 0 1\n' +
            '3 4 3 2\n' +
            '3 2 3 0\n' +
            '3 5 3 4\n' +
            '3 5 4 6\n' +
            '3 5 6 7\n' +
            '3 6 8 7\n' +
            '3 11 9 10\n' +
            '3 11 10 12\n' +
            '3 12 13 14\n' +
            '3 17 15 16\n' +
            '3 20 18 19\n' +
            '3 23 21 22\n' +
            '3 26 24 25\n' +
            '3 28 25 27\n' +
            '3 30 27 29\n' +
            '3 27 31 32\n' +
            '3 33 31 27\n' +
            '3 27 32 29\n' +
            '3 36 34 35\n' +
            '3 28 27 30\n' +
            '3 37 25 28\n' +
            '3 26 25 37\n' +
            '3 39 38 22\n' +
            '3 40 38 39\n' +
            '3 40 39 41\n' +
            '3 43 40 42\n' +
            '3 44 18 20\n' +
            '3 20 19 45\n' +
            '3 47 46 45\n' +
            '3 49 48 46\n' +
            '3 52 50 51\n' +
            '3 55 53 54\n' +
            '3 58 56 57\n' +
            '3 56 59 57\n' +
            '3 61 58 60\n' +
            '3 60 62 63\n' +
            '3 63 64 65\n' +
            '3 65 66 67\n' +
            '3 66 68 67\n' +
            '3 68 69 67\n' +
            '3 71 35 70\n' +
            '3 34 72 35\n' +
            '3 35 72 73\n' +
            '3 35 73 74\n' +
            '3 35 74 70\n' +
            '3 75 35 71\n' +
            '3 75 71 69\n' +
            '3 75 69 68\n' +
            '3 64 66 65\n' +
            '3 62 64 63\n' +
            '3 58 62 60\n' +
            '3 56 58 61\n' +
            '3 59 55 57\n' +
            '3 55 54 57\n' +
            '3 53 76 54\n' +
            '3 50 76 53\n' +
            '3 50 53 51\n' +
            '3 52 51 48\n' +
            '3 52 48 49\n' +
            '3 49 46 47\n' +
            '3 47 45 19\n' +
            '3 17 16 77\n' +
            '3 14 15 17\n' +
            '3 79 16 78\n' +
            '3 44 43 18\n' +
            '3 43 42 18\n' +
            '3 80 78 23\n' +
            '3 40 41 42\n' +
            '3 21 24 22\n' +
            '3 39 22 26\n' +
            '3 22 24 26\n' +
            '3 23 78 21\n' +
            '3 80 79 78\n' +
            '3 77 16 79\n' +
            '3 13 15 14\n' +
            '3 10 13 12\n' +
            '3 81 9 11\n' +
            '3 8 9 81\n' +
            '3 8 81 7\n' +
            '',
          hash: '0sOLczDVd0kw21mvKMCtNU1q+DNt0WucLC3AgoX+nqA=',
        },
        cache: {
          boundingBox: [
            [0.018518518518518504, -0.002398081534772184, -2e-323],
            [0.3043478260869567, 0.25714285714285734, 1.5e-323],
          ],
        },
      },
      {
        type: 'graph',
        tags: [],
        graph: {
          isClosed: false,
          isEmpty: false,
          isLazy: true,
          provenance: 'algorithm/cgal/fromSurfaceMeshToLazyGraph',
          isOutline: false,
          serializedSurfaceMesh:
            '72\n' +
            '3777212590697835/9007199254740992 4348303088495651/18014398509481984 0\n' +
            '7678268217156255/18014398509481984 8533136136070413/36028797018963968 0\n' +
            '948126237341157/2251799813685248 8914341530465311/36028797018963968 0\n' +
            '5482643024624951/18014398509481984 2882303761517117/18014398509481984 0\n' +
            '4608334502425623/18014398509481984 2484744621997515/36028797018963968 0\n' +
            '5272506880823995/18014398509481984 2001599834386887/18014398509481984 0\n' +
            '2292741628479525/9007199254740992 6550690367084357/144115188075855872 0\n' +
            '4238682002231055/18014398509481984 667199944795629/18014398509481984 0\n' +
            '1080863910568919/4503599627370496 8235153604334621/288230376151711744 0\n' +
            '8406719304424925/36028797018963968 4803839602528529/144115188075855872 0\n' +
            '8533136136070413/36028797018963968 7790010166262479/288230376151711744 0\n' +
            '2855941227112997/9007199254740992 5/32 0\n' +
            '3152519739159347/9007199254740992 1566469435607129/9007199254740992 0\n' +
            '3335999723978145/9007199254740992 5912417972342805/2305843009213693952 0\n' +
            '3179011501673291/9007199254740992 316042079113719/18014398509481984 0\n' +
            '11/32 -298994166132481/144115188075855872 0\n' +
            '5811096293381285/18014398509481984 5490102402889747/2305843009213693952 0\n' +
            '6093105378207141/18014398509481984 6004799503160661/288230376151711744 0\n' +
            '1463669878895411/4503599627370496 1162219258676257/36028797018963968 0\n' +
            '2573485501354569/9007199254740992 4803839602528529/144115188075855872 0\n' +
            '2649176251394409/9007199254740992 2882303761517117/144115188075855872 0\n' +
            '2882303761517117/9007199254740992 7205759403792793/144115188075855872 0\n' +
            '5504399544563939/18014398509481984 667199944795629/72057594037927936 0\n' +
            '2540492097491049/9007199254740992 7205759403792793/144115188075855872 0\n' +
            '5091025665723169/18014398509481984 4803839602528529/72057594037927936 0\n' +
            '7110946780058677/18014398509481984 5490102402889747/576460752303423488 0\n' +
            '3752999689475413/9007199254740992 2882303761517117/144115188075855872 0\n' +
            '875699927544263/2251799813685248 5542891849071379/144115188075855872 0\n' +
            '7339199392751919/18014398509481984 4238682002231055/72057594037927936 0\n' +
            '866076851417403/2251799813685248 6903721584472137/1152921504606846976 0\n' +
            '2001599834386887/4503599627370496 6004799503160661/144115188075855872 0\n' +
            '7621476292473147/18014398509481984 2844378712023471/36028797018963968 0\n' +
            '4278419646001971/9007199254740992 5842507624696859/72057594037927936 0\n' +
            '8910347649851303/18014398509481984 4599420896037953/36028797018963968 0\n' +
            '2026619832316723/4503599627370496 1/8 0\n' +
            '4528759401825079/9007199254740992 5404319552844595/36028797018963968 0\n' +
            '8314337773607069/18014398509481984 667199944795629/4503599627370496 0\n' +
            '7959850504189713/18014398509481984 4289142502257615/18014398509481984 0\n' +
            '7806239354108859/18014398509481984 4557859863844839/18014398509481984 0\n' +
            '7832347178035645/18014398509481984 8533136136070413/36028797018963968 0\n' +
            '2001599834386887/4503599627370496 2272086298493223/9007199254740992 0\n' +
            '3752999689475413/9007199254740992 3335999723978145/9007199254740992 0\n' +
            '8880337293406611/18014398509481984 7339199392751919/18014398509481984 0\n' +
            '990791918021509/2251799813685248 3684763331484951/9007199254740992 0\n' +
            '2037342688572367/4503599627370496 7656119366529843/18014398509481984 0\n' +
            '7720456504063707/18014398509481984 5/16 0\n' +
            '4238682002231055/9007199254740992 8734253822779143/36028797018963968 0\n' +
            '8363827879402349/18014398509481984 8188362958855447/36028797018963968 0\n' +
            '4348303088495651/9007199254740992 8406719304424925/36028797018963968 0\n' +
            '6550690367084357/18014398509481984 7296971548144601/36028797018963968 0\n' +
            '4699408306821387/9007199254740992 1986882188545807/4503599627370496 0\n' +
            '1160018085837855/2251799813685248 1986882188545807/4503599627370496 0\n' +
            '282918438129685/562949953421312 7205759403792793/36028797018963968 0\n' +
            '8533136136070413/18014398509481984 3548290615504027/18014398509481984 0\n' +
            '284376780594271/562949953421312 6004799503160661/36028797018963968 0\n' +
            '6505199461757383/18014398509481984 4850030367937457/18014398509481984 0\n' +
            '8406719304424925/18014398509481984 740317746965013/4503599627370496 0\n' +
            '4238682002231055/9007199254740992 7832347178035645/36028797018963968 0\n' +
            '8188362958855447/18014398509481984 1/4 0\n' +
            '8188362958855447/18014398509481984 4238682002231055/18014398509481984 0\n' +
            '8854534860592839/18014398509481984 2001599834386887/9007199254740992 0\n' +
            '5514611788616933/18014398509481984 4868756353914049/36028797018963968 0\n' +
            '1307496666010789/4503599627370496 857828500451523/9007199254740992 0\n' +
            '2957587814989579/9007199254740992 8235153604334621/72057594037927936 0\n' +
            '2573485501354569/9007199254740992 5542891849071379/72057594037927936 0\n' +
            '1447585594511945/4503599627370496 5272506880823995/72057594037927936 0\n' +
            '6605279453476727/18014398509481984 6132561194717271/288230376151711744 0\n' +
            '3117876665102651/9007199254740992 2620276146833743/144115188075855872 0\n' +
            '866076851417403/2251799813685248 4289142502257615/18014398509481984 0\n' +
            '8854534860592839/18014398509481984 2001599834386887/4503599627370496 0\n' +
            '4348303088495651/9007199254740992 2001599834386887/4503599627370496 0\n' +
            '4238682002231055/9007199254740992 990791918021509/2251799813685248 0\n' +
            '\n' +
            '70\n' +
            '3 2 0 1\n' +
            '3 5 3 4\n' +
            '3 8 6 7\n' +
            '3 6 4 7\n' +
            '3 8 9 10\n' +
            '3 7 9 8\n' +
            '3 5 4 6\n' +
            '3 11 3 5\n' +
            '3 12 3 11\n' +
            '3 15 13 14\n' +
            '3 18 16 17\n' +
            '3 21 19 20\n' +
            '3 17 16 15\n' +
            '3 20 22 18\n' +
            '3 24 23 21\n' +
            '3 27 25 26\n' +
            '3 27 26 28\n' +
            '3 29 25 27\n' +
            '3 30 28 26\n' +
            '3 32 31 30\n' +
            '3 34 32 33\n' +
            '3 36 33 35\n' +
            '3 39 37 38\n' +
            '3 39 38 1\n' +
            '3 40 38 37\n' +
            '3 38 2 1\n' +
            '3 43 41 42\n' +
            '3 43 42 44\n' +
            '3 42 41 45\n' +
            '3 48 46 47\n' +
            '3 3 12 49\n' +
            '3 42 50 51\n' +
            '3 54 52 53\n' +
            '3 55 45 41\n' +
            '3 54 53 56\n' +
            '3 48 47 57\n' +
            '3 59 46 58\n' +
            '3 40 37 58\n' +
            '3 37 59 58\n' +
            '3 47 46 59\n' +
            '3 57 53 60\n' +
            '3 48 57 60\n' +
            '3 53 52 60\n' +
            '3 56 35 54\n' +
            '3 56 36 35\n' +
            '3 63 61 62\n' +
            '3 36 34 33\n' +
            '3 34 31 32\n' +
            '3 65 62 64\n' +
            '3 31 28 30\n' +
            '3 24 21 65\n' +
            '3 66 13 29\n' +
            '3 27 66 29\n' +
            '3 14 13 66\n' +
            '3 64 24 65\n' +
            '3 67 17 15\n' +
            '3 14 67 15\n' +
            '3 22 16 18\n' +
            '3 20 18 21\n' +
            '3 21 23 19\n' +
            '3 63 62 65\n' +
            '3 63 11 61\n' +
            '3 11 63 12\n' +
            '3 55 3 49\n' +
            '3 55 49 68\n' +
            '3 55 68 45\n' +
            '3 42 51 69\n' +
            '3 42 69 70\n' +
            '3 42 70 71\n' +
            '3 42 71 44\n' +
            '',
          hash: 'sjl8hAdqouGYDQ9XZlkL5Mq9F5aTuIdh3qG11qxg8gM=',
        },
        cache: {
          boundingBox: [
            [0.2333333333333332, -0.0020746887966804992, -2e-323],
            [0.521739130434783, 0.44444444444444464, 1.5e-323],
          ],
        },
      },
    ],
  });
});
