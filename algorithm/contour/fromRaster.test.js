import '@jsxcad/algorithm-cgal';

import { boot } from '@jsxcad/sys';
import { fromRaster } from './fromRaster.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await boot();
});

test('Simple', async (t) => {
  const raster = [
    [13, 34, 53, 75],
    [34, 46, 61, 79],
    [59, 64, 71, 86],
    [77, 81, 86, 99],
  ];
  const result = await fromRaster(raster, [0, 25, 50, 75, 100]);
  t.deepEqual(JSON.parse(JSON.stringify(result)), [
    {
      type: 'segments',
      segments: [
        [
          [0, 0.5714285714285714, 0],
          [0.5714285714285714, 0, 0],
          '0 2573485501354569/4503599627370496 0 2573485501354569/4503599627370496 0 0',
        ],
        [
          [0.5714285714285714, 0, 0],
          [0, 0, 0],
          '2573485501354569/4503599627370496 0 0 0 0 0',
        ],
        [
          [0, 0, 0],
          [0, 0.5714285714285714, 0],
          '0 0 0 0 2573485501354569/4503599627370496 0',
        ],
        [
          [0, 0.5714285714285714, 0],
          [0, 0.5714285714285714, 0],
          '0 2573485501354569/4503599627370496 0 0 2573485501354569/4503599627370496 0',
        ],
      ],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'segments',
      segments: [
        [
          [0.5714285714285714, 0, 0],
          [0, 0.5714285714285714, 0],
          '2573485501354569/4503599627370496 0 0 0 2573485501354569/4503599627370496 0',
        ],
        [
          [0, 0.5714285714285714, 0],
          [0, 1, 0],
          '0 2573485501354569/4503599627370496 0 0 1 0',
        ],
        [[0, 1, 0], [0, 2, 0], '0 1 0 0 2 0'],
        [
          [0, 2, 0],
          [0, 2.888888888888889, 0],
          '0 2 0 0 6505199461757383/2251799813685248 0',
        ],
        [
          [0, 2.888888888888889, 0],
          [1.0000000000000004, 2.647058823529412, 0],
          '0 6505199461757383/2251799813685248 0 1 5960646565637421/2251799813685248 0',
        ],
        [
          [1.0000000000000004, 2.647058823529412, 0],
          [2.000000000000001, 2.2666666666666666, 0],
          '1 5960646565637421/2251799813685248 0 2 2552039788843281/1125899906842624 0',
        ],
        [
          [2.000000000000001, 2.2666666666666666, 0],
          [2.2666666666666666, 2.000000000000001, 0],
          '2 2552039788843281/1125899906842624 0 2552039788843281/1125899906842624 2 0',
        ],
        [
          [2.2666666666666666, 2.000000000000001, 0],
          [2.777777777777778, 1.0000000000000004, 0],
          '2552039788843281/1125899906842624 2 0 3127499741229511/1125899906842624 1 0',
        ],
        [
          [2.777777777777778, 1.0000000000000004, 0],
          [3.0000000000000004, 0, 0],
          '3127499741229511/1125899906842624 1 0 3 0 0',
        ],
        [[3.0000000000000004, 0, 0], [3.0000000000000004, 0, 0], '3 0 0 3 0 0'],
        [[3.0000000000000004, 0, 0], [2.000000000000001, 0, 0], '3 0 0 2 0 0'],
        [[2.000000000000001, 0, 0], [1.0000000000000004, 0, 0], '2 0 0 1 0 0'],
        [
          [1.0000000000000004, 0, 0],
          [0.5714285714285714, 0, 0],
          '1 0 0 2573485501354569/4503599627370496 0 0',
        ],
        [
          [0.5714285714285714, 0, 0],
          [0.5714285714285714, 0, 0],
          '2573485501354569/4503599627370496 0 0 2573485501354569/4503599627370496 0 0',
        ],
      ],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'segments',
      segments: [
        [
          [1.0000000000000004, 1.2222222222222223, 0],
          [0, 1.6400000000000001, 0],
          '1 1376099886140985/1125899906842624 0 0 3692951694443807/2251799813685248 0',
        ],
        [
          [0, 1.6400000000000001, 0],
          [0, 2, 0],
          '0 3692951694443807/2251799813685248 0 0 2 0',
        ],
        [[0, 2, 0], [0, 3, 0], '0 2 0 0 3 0'],
        [[0, 3, 0], [1.0000000000000004, 3.0000000000000004, 0], '0 3 0 1 3 0'],
        [
          [1.0000000000000004, 3.0000000000000004, 0],
          [2.000000000000001, 3.0000000000000004, 0],
          '1 3 0 2 3 0',
        ],
        [
          [2.000000000000001, 3.0000000000000004, 0],
          [3.0000000000000004, 3.0000000000000004, 0],
          '2 3 0 3 3 0',
        ],
        [
          [3.0000000000000004, 3.0000000000000004, 0],
          [3.0000000000000004, 2.000000000000001, 0],
          '3 3 0 3 2 0',
        ],
        [
          [3.0000000000000004, 2.000000000000001, 0],
          [3.0000000000000004, 1.0000000000000004, 0],
          '3 2 0 3 1 0',
        ],
        [
          [3.0000000000000004, 1.0000000000000004, 0],
          [3.0000000000000004, 0, 0],
          '3 1 0 3 0 0',
        ],
        [[3.0000000000000004, 0, 0], [2.000000000000001, 0, 0], '3 0 0 2 0 0'],
        [
          [2.000000000000001, 0, 0],
          [1.842105263157895, 0, 0],
          '2 0 0 2074026144183781/1125899906842624 0 0',
        ],
        [
          [1.842105263157895, 0, 0],
          [1.2666666666666668, 1.0000000000000004, 0],
          '2074026144183781/1125899906842624 0 0 1426139882000657/1125899906842624 1 0',
        ],
        [
          [1.2666666666666668, 1.0000000000000004, 0],
          [1.0000000000000004, 1.2222222222222223, 0],
          '1426139882000657/1125899906842624 1 0 1 1376099886140985/1125899906842624 0',
        ],
        [
          [1.0000000000000004, 1.2222222222222223, 0],
          [1.0000000000000004, 1.2222222222222223, 0],
          '1 1376099886140985/1125899906842624 0 1 1376099886140985/1125899906842624 0',
        ],
      ],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'segments',
      segments: [
        [
          [1.0000000000000004, 2.647058823529412, 0],
          [0, 2.888888888888889, 0],
          '1 5960646565637421/2251799813685248 0 0 6505199461757383/2251799813685248 0',
        ],
        [
          [0, 2.888888888888889, 0],
          [0, 3, 0],
          '0 6505199461757383/2251799813685248 0 0 3 0',
        ],
        [[0, 3, 0], [1.0000000000000004, 3.0000000000000004, 0], '0 3 0 1 3 0'],
        [
          [1.0000000000000004, 3.0000000000000004, 0],
          [2.000000000000001, 3.0000000000000004, 0],
          '1 3 0 2 3 0',
        ],
        [
          [2.000000000000001, 3.0000000000000004, 0],
          [3.0000000000000004, 3.0000000000000004, 0],
          '2 3 0 3 3 0',
        ],
        [
          [3.0000000000000004, 3.0000000000000004, 0],
          [3.0000000000000004, 2.000000000000001, 0],
          '3 3 0 3 2 0',
        ],
        [
          [3.0000000000000004, 2.000000000000001, 0],
          [3.0000000000000004, 1.0000000000000004, 0],
          '3 2 0 3 1 0',
        ],
        [
          [3.0000000000000004, 1.0000000000000004, 0],
          [3.0000000000000004, 0, 0],
          '3 1 0 3 0 0',
        ],
        [[3.0000000000000004, 0, 0], [3.0000000000000004, 0, 0], '3 0 0 3 0 0'],
        [
          [3.0000000000000004, 0, 0],
          [2.777777777777778, 1.0000000000000004, 0],
          '3 0 0 3127499741229511/1125899906842624 1 0',
        ],
        [
          [2.777777777777778, 1.0000000000000004, 0],
          [2.2666666666666666, 2.000000000000001, 0],
          '3127499741229511/1125899906842624 1 0 2552039788843281/1125899906842624 2 0',
        ],
        [
          [2.2666666666666666, 2.000000000000001, 0],
          [2.000000000000001, 2.2666666666666666, 0],
          '2552039788843281/1125899906842624 2 0 2 2552039788843281/1125899906842624 0',
        ],
        [
          [2.000000000000001, 2.2666666666666666, 0],
          [1.0000000000000004, 2.647058823529412, 0],
          '2 2552039788843281/1125899906842624 0 1 5960646565637421/2251799813685248 0',
        ],
        [
          [1.0000000000000004, 2.647058823529412, 0],
          [1.0000000000000004, 2.647058823529412, 0],
          '1 5960646565637421/2251799813685248 0 1 5960646565637421/2251799813685248 0',
        ],
      ],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
  ]);
});
