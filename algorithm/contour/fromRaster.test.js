import '@jsxcad/algorithm-cgal';

import { boot } from '@jsxcad/sys';
import { fromRaster } from './fromRaster.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await boot();
});

test('Simple', async (t) => {
  const raster = [
    [13, 34, 53, 75],
    [34, 46, 61, 79],
    [59, 64, 71, 86],
    [77, 81, 86, 99],
  ];
  const result = await fromRaster(raster, [0, 25, 50, 75, 100]);
  t.deepEqual(JSON.parse(JSON.stringify(result)), [
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [0, 0.5714285714285714],
            [0, 0],
            [0.5714285714285714, 0],
          ],
          exactPoints: [
            ['0', '2573485501354569/4503599627370496'],
            ['0', '0'],
            ['2573485501354569/4503599627370496', '0'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [0.5714285714285714, 0],
            [1, 0],
            [2, 0],
            [3, 0],
            [2.7777777777777777, 1],
            [2.2666666666666666, 2],
            [2, 2.2666666666666666],
            [1, 2.6470588235294117],
            [0, 2.888888888888889],
            [0, 2],
            [0, 1],
            [0, 0.5714285714285714],
          ],
          exactPoints: [
            ['2573485501354569/4503599627370496', '0'],
            ['1', '0'],
            ['2', '0'],
            ['3', '0'],
            ['3127499741229511/1125899906842624', '1'],
            ['2552039788843281/1125899906842624', '2'],
            ['2', '2552039788843281/1125899906842624'],
            ['1', '5960646565637421/2251799813685248'],
            ['0', '6505199461757383/2251799813685248'],
            ['0', '2'],
            ['0', '1'],
            ['0', '2573485501354569/4503599627370496'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [1, 1.2222222222222223],
            [1.2666666666666666, 1],
            [1.8421052631578947, 0],
            [2, 0],
            [3, 0],
            [3, 1],
            [3, 2],
            [3, 3],
            [2, 3],
            [1, 3],
            [0, 3],
            [0, 2],
            [0, 1.6400000000000001],
          ],
          exactPoints: [
            ['1', '1376099886140985/1125899906842624'],
            ['1426139882000657/1125899906842624', '1'],
            ['2074026144183781/1125899906842624', '0'],
            ['2', '0'],
            ['3', '0'],
            ['3', '1'],
            ['3', '2'],
            ['3', '3'],
            ['2', '3'],
            ['1', '3'],
            ['0', '3'],
            ['0', '2'],
            ['0', '3692951694443807/2251799813685248'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
    {
      type: 'polygonsWithHoles',
      polygonsWithHoles: [
        {
          points: [
            [1, 2.6470588235294117],
            [2, 2.2666666666666666],
            [2.2666666666666666, 2],
            [2.7777777777777777, 1],
            [3, 0],
            [3, 1],
            [3, 2],
            [3, 3],
            [2, 3],
            [1, 3],
            [0, 3],
            [0, 2.888888888888889],
          ],
          exactPoints: [
            ['1', '5960646565637421/2251799813685248'],
            ['2', '2552039788843281/1125899906842624'],
            ['2552039788843281/1125899906842624', '2'],
            ['3127499741229511/1125899906842624', '1'],
            ['3', '0'],
            ['3', '1'],
            ['3', '2'],
            ['3', '3'],
            ['2', '3'],
            ['1', '3'],
            ['0', '3'],
            ['0', '6505199461757383/2251799813685248'],
          ],
          holes: [],
        },
      ],
      plane: [0, 0, 1, 0],
      exactPlane: ['0', '0', '1', '0'],
      matrix: [
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        1,
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '0',
        '0',
        '0',
        '1',
        '0',
        '1',
      ],
      tags: [],
    },
  ]);
});
